
### (1) åç«¯éƒ¨ç½²æ–‡ä»¶å¤¹
ä¸€èˆ¬åœ°ï¼Œ é‡‡ç”¨é¡¹ç›®ä¸‹çš„ api æ–‡ä»¶å¤¹æˆ–è€… network/service æ–‡ä»¶å¤¹å°è£…åç«¯è¯·æ±‚éƒ¨åˆ†;

åœ¨ `api` æ–‡ä»¶å¤¹ä¸­ï¼Œä½ å¯ä»¥å°è£… HTTP è¯·æ±‚åº“ï¼ˆå¦‚ `axios`ï¼‰çš„å®ä¾‹ï¼Œè¿™æ ·å¯ä»¥é›†ä¸­ç®¡ç†è¯·æ±‚ã€å¤„ç†å“åº”ã€é…ç½®æ‹¦æˆªå™¨å’Œé”™è¯¯å¤„ç†ã€‚

é¦–å…ˆé€šè¿‡ `axios.create({})` æŒ‡å®šå¯¹åº”çš„è¿æ¥ url, å®é™…ä¸Šéœ€è¦æŒ‡å®šåç«¯çš„ url å’Œç«¯å£; å¦å¤–çš„æ–¹å¼å‚è€ƒ [[ğŸ“˜ClassNotes/âŒ¨ï¸ Web Programming/ğŸPython Web ä¸ Flask æ¡†æ¶/Flask æ¡†æ¶å…¥é—¨/3. å°†å‰ç«¯ä»£ç†åˆ°åç«¯#(3) åœ¨ä»£ç ä¸­ä½¿ç”¨ API åœ°å€|åœ¨ä»£ç ä¸­ä½¿ç”¨ API åœ°å€]]  éƒ¨åˆ†, ä½†æ˜¯é‡‡ç”¨ request ä¹Ÿæ˜¯å¸¸ç”¨çš„å°è£…æ–¹å¼ã€‚

```ts title:request.ts
import axios from "axios"; // const axios = require("axios");

const request = axios.create({
    baseURL: "http://127.0.0.1:5000",
    headers: {
        "Content-Type": "application/json",
        // In Allication, set as 'Access-Control-Allow-Origin': 'https://your-frontend-domain.com'
    },
    timeout: 3000,
});
export default request;
```

```ts title:user_module.ts
// åœ¨å¦å¤–ä¸€ä¸ªæ–‡ä»¶ç¼–å†™ä¸€ä¸ª getUserInfo å‡½æ•°ç”¨äºæµ‹è¯•, å¹¶é‡‡ç”¨ export æš´éœ²(å¯ä»¥ä¸€ä¸ªæ–‡ä»¶ä¸­ç”¨å¤šä¸ªexport æ¥æš´éœ²å¤šä¸ªå‡½æ•°)
export async function getUserInfo(user_id: number) {
    try {
        const response = await request.get("/user", {
            params: {
                id: user_id,
            },
        });
        console.log(response.data);
        return response.data;
    } catch (error) {
        console.log(error);
    }
}
```

åœ¨ flask æ¡†æ¶ä¸­ï¼Œ å¯ä»¥é‡‡ç”¨ request.args.get å¾—åˆ°å¯¹åº”çš„å‚æ•°å€¼, å¦‚ä¸‹: 
```python
@app.route("/user", methods=["GET"])  
def user():  
    id = request.args.get("id")  
    result = query_crew(User, id=id)  
    message = {  
        "id": result[0].id,  
        "name": result[0].name,  
        "email": result[0].email,  
        "priority": result[0].priority  
    }  
    return message
```

æœ€ç»ˆé‡‡ç”¨æŒ‰é’®è°ƒç”¨ï¼Œ å¾—åˆ°åç«¯çš„å“åº”æµ‹è¯•å¦‚ä¸‹ :
```ts
<template>
	<button @click="getUserInfById(5)">Get User Info</button>
</template>

<script lang="ts">
import { RouterLink } from "vue-router";
import { getUserInfo } from "@api/auth/user_module";

export default {
    name: "AboutPage",
    components: {
        RouterLink,
    },
    methods: {
        async getUserInfById(user_id: number) {
            const response = await getUserInfo(user_id);
            console.log(response);
        },
    },
};
</script>

<style scoped></style>
```

å®¹æ˜“å¾—åˆ°å¦‚ä¸‹çš„åç«¯å“åº” : 
![[attachments/Pasted image 20250103173308.png|350]]

éœ€è¦è¯´æ˜, å¦‚æœéœ€è¦å¯¹å‰ç«¯çš„è®¿é—®æ¥æºè¿›è¡Œæ§åˆ¶ , flask-cors å¯¹åº”çš„éƒ¨åˆ†: 
```python
CORS(app)  # é»˜è®¤å…è®¸æ‰€æœ‰ 

CORS(app, resources={
	r"/api/*": {"origin": "https://your-frontend-domain.com"}   # å¯ä»¥é€šè¿‡è¯¥é…ç½®ï¼Œä»…å…è®¸é‡‡ç”¨æŸä¸€ç‰¹å®šåŸŸåçš„ä¸»æœºè¿›è¡Œè®¿é—®è¯¥åç«¯æœåŠ¡ç«¯å£ã€‚
})
```

è¡¥å…… : å¦‚æœéœ€è¦è·¨åŸŸè¯·æ±‚æ—¶å‘é€ cookies æˆ–å…¶ä»–å‡­è¯ä¿¡æ¯ï¼Œéœ€è¦è®¾ç½® `withCredentials` ä¸º `true`, ä½†æ˜¯ï¼Œ`withCredentials` çš„ä½¿ç”¨éœ€è¦åç«¯æ˜ç¡®å…è®¸ï¼Œå¹¶ä¸”è¿”å›å¤´éœ€è¦åŒ…å« `Access-Control-Allow-Credentials: true`  
```python
axios.get("/user", {
  params: {
    id: user_id
  },
  headers: {
    // å¯ä»¥åŠ ä¸Šå…¶ä»–éœ€è¦çš„è¯·æ±‚å¤´
  },
  withCredentials: true  // å…è®¸æºå¸¦å‡­è¯ï¼ˆå¦‚ cookiesï¼‰
})
.then(response => {
  console.log(response.data);
})
.catch(error => {
  console.error(error);
});
```

