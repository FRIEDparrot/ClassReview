### (1) åŠ¨æ€è·¯ç”±ç¼–å†™æ–¹æ³• 
ä½ å¯ä»¥ä½¿ç”¨ **åŠ¨æ€è·¯ç”±åŒ¹é… (`:locale`)**ï¼Œè®© `/rules/:locale/privacy_policy` è‡ªåŠ¨è§£æä¸åŒçš„è¯­è¨€ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ç»„ä»¶ã€‚è¿™ç§æ–¹å¼æ—¢çµæ´»åˆèƒ½å‡å°‘é‡å¤ä»£ç ã€‚

åŸºæœ¬è¯­æ³•: 
```ts
path: "/rules/:locale/:rule_name",
```

åœ¨ `router/index.js`ä¸­å®šä¹‰åŠ¨æ€è·¯ç”±: 
```javascript
import { createRouter, createWebHistory } from "vue-router";
import PrivacyPolicy from "@/views/PrivacyPolicy.vue"; // å‡è®¾è¿™ä¸ªæ˜¯ä½ çš„éšç§æ”¿ç­–ç»„ä»¶

const routes = [
  {
    path: "/rules/:locale/privacy_policy",
    name: "PrivacyPolicy",
    component: PrivacyPolicy,
    props: true, // å…è®¸å°† `locale` ä½œä¸º prop ä¼ å…¥ç»„ä»¶
  },
];

const router = createRouter({
  history: createWebHistory(),
  routes,
});
export default router;
```

ç„¶åå¯ä»¥åœ¨å…¶ä¸­ä¸€ä¸ªç•Œé¢ç›´æ¥è¿›è¡Œç¿»è¯‘, ä¾‹å¦‚åœ¨ `PrivacyPolicy.vue` ç»„ä»¶ä¸­è·å– `locale` å¹¶åŠ¨æ€åŠ è½½å†…å®¹: 
```vue
<script setup>
import { useRoute } from "vue-router";
import { useI18n } from "vue-i18n";

const route = useRoute();
const { locale, t } = useI18n();

// æ›´æ–° i18n è¯­è¨€
locale.value = route.params.locale;
</script>

<template>
  <div>
    <h1>{{ t("privacy_policy.title") }}</h1>
    <p>{{ t("privacy_policy.content") }}</p>
  </div>
</template>
```
å…¶ä¸­:
- `route.params.locale` ç›´æ¥ä» URL è§£æè¯­è¨€ä»£ç ï¼ˆå¦‚ `en`ã€`zh`ï¼‰ã€‚
- `locale.value = route.params.locale` åŠ¨æ€åˆ‡æ¢ `i18n` è¯­è¨€ã€‚

### (2) route.beforeEach ç¼–å†™
beforeach æœ‰ to, from , next ä¸‰ä¸ªå‚æ•°, åœ¨ Vue Router ä¸­ï¼Œ`router.beforeEach` éœ€è¦ **ç¡®ä¿ `next()` è¢«æ­£ç¡®è°ƒç”¨**ã€‚å¦‚æœ `next()` æ²¡æœ‰è¢«è°ƒç”¨ï¼Œè·¯ç”±ä¸ä¼šç»§ç»­è§£æï¼Œé¡µé¢ä¹Ÿä¸ä¼šæ¸²æŸ“ã€‚ 

ä¾‹å¦‚, å¦‚æœæœ‰ä¸æ”¯æŒçš„ locale å‚æ•°è¾“å…¥, å¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹æ³•, è¿›è¡Œé‡å®šå‘åˆ° en éƒ¨åˆ†: 
```ts
router.beforeEach((to, from, next) => {
    if (
        to.params.locale &&
        !SupportedLanguages.includes(
            Array.isArray(to.params.locale) // if locale is an array, take the first element
                ? to.params.locale[0]
                : to.params.locale,
        )
    ) {
        // redirect to the params with english language
        next({ name: to.name, params: { ...to.params, locale: "en" } });
    } else {
        next(); // make the request normally
    }
});
```

å¯¹äºå¯¼èˆªåˆ°ä¸åŒè¯­è¨€çš„éšç§æ”¿ç­–, å¯ä»¥é‡‡ç”¨å¦‚ä¸‹çš„ router_link å¯¼èˆªæ–¹æ³•: 
```javascript
router.push({ name: "rules", params: { locale: "zh" } });
```

å¦‚æœç”¨ router-link, é‡‡ç”¨æ–¹æ³•æ˜¯ç±»ä¼¼çš„ : 
```ts
{
	/* for language selection, we use locale for the path */
	path: "/rules/:locale/:page_name",
	name: "rules",   // æ³¨æ„ name å’Œä¸‹é¢ name å¿…é¡»ä¸€è‡´ä¸”åŒºåˆ†å¤§å°å†™, name æ˜¯router çš„å”¯ä¸€æ ‡è¯†
	component: WelcomePage,
	props: true, // dynamic route
	meta: {
		title: {},
	},
},
```

å¯¹åº”çš„ router-link è¿™æ ·å†™: 
```vue 
<router-link
	:to="{
		name: 'rules', // name in router
		params: {
			locale: $i18n.locale || 'en',
			page_name: 'cookie_policy',
		},
	}"
>
	Cookie Policy
</router-link>
```

### (3) Vue å¤šè·¯ç”±åŒ¹é…å’ŒåŠ¨æ€æ¸²æŸ“

æ˜¯çš„ï¼Œä½ å¯ä»¥æ ¹æ® `page_name` çš„ä¸åŒï¼ŒåŠ¨æ€åŠ è½½ä¸åŒçš„ç»„ä»¶ã€‚Vue Router æä¾›äº† **åŠ¨æ€ç»„ä»¶æ¸²æŸ“** çš„èƒ½åŠ›ï¼Œä½ å¯ä»¥åœ¨ `WelcomePage` ç»„ä»¶å†…éƒ¨ï¼Œé€šè¿‡ `page_name` é€‰æ‹©ä¸åŒçš„ç»„ä»¶è¿›è¡Œæ¸²æŸ“ã€‚  


## **å®ç°æ–¹æ¡ˆ**
### **1. ä½¿ç”¨ `component` åŠ¨æ€åˆ‡æ¢ç•Œé¢**
åœ¨ `WelcomePage.vue` é‡Œï¼Œä½ å¯ä»¥ä½¿ç”¨ Vue çš„ `<component>` ç»„ä»¶ï¼ŒåŠ¨æ€æ¸²æŸ“ä¸åŒçš„å­ç»„ä»¶ã€‚

#### **WelcomePage.vue**
```vue
<template>
  <div>
    <component :is="currentComponent"></component>
  </div>
</template>

<script>
import CookiePolicy from "@/components/CookiePolicy.vue";
import TermsOfService from "@/components/TermsOfService.vue";
import PrivacyPolicy from "@/components/PrivacyPolicy.vue";

export default {
  props: ["page_name"],  // Vue Router ä¼šæŠŠ `:page_name` ä½œä¸º prop ä¼ å…¥
  computed: {
    currentComponent() {
      const components = {
        cookie_policy: CookiePolicy,
        terms_of_service: TermsOfService,
        privacy_policy: PrivacyPolicy,
      };
      return components[this.page_name] || CookiePolicy; // é»˜è®¤æ¸²æŸ“ CookiePolicy
    },
  },
};
</script>
```

---

### **2. é…ç½® `router-link` è¿›è¡Œå¯¼èˆª**
```vue
<router-link
  :to="{
    name: 'rules',
    params: { locale: $i18n.locale || 'en', page_name: 'cookie_policy' }
  }"
>
  Cookie Policy
</router-link>

<router-link
  :to="{
    name: 'rules',
    params: { locale: $i18n.locale || 'en', page_name: 'terms_of_service' }
  }"
>
  Terms of Service
</router-link>

<router-link
  :to="{
    name: 'rules',
    params: { locale: $i18n.locale || 'en', page_name: 'privacy_policy' }
  }"
>
  Privacy Policy
</router-link>
```

---

## **å·¥ä½œåŸç†**
1. **è·¯ç”±åŒ¹é…**  
   - `/rules/en/cookie_policy` ä¼šåŒ¹é… `path: "/rules/:locale/:page_name"`ï¼Œå¹¶å°† `page_name` ä½œä¸º `props` ä¼ é€’ç»™ `WelcomePage`ã€‚
  
2. **åŠ¨æ€ç»„ä»¶æ¸²æŸ“**
   - `WelcomePage` é€šè¿‡ `computed: currentComponent()`ï¼Œæ ¹æ® `page_name` é€‰æ‹©æ­£ç¡®çš„ç»„ä»¶ï¼Œå¹¶é€šè¿‡ `<component :is="...">` è¿›è¡Œæ¸²æŸ“ã€‚

3. **çµæ´»æ€§**
   - ä½ å¯ä»¥æ·»åŠ æ›´å¤šçš„ `page_name` å’Œå¯¹åº”çš„ç»„ä»¶ï¼Œè€Œæ— éœ€ä¿®æ”¹ `router` é…ç½®ã€‚

---

## **å¦‚æœ `components` éœ€è¦æ‡’åŠ è½½**
å¦‚æœä½ æœ‰å¤šä¸ªé¡µé¢ï¼Œå»ºè®®ä½¿ç”¨ **æ‡’åŠ è½½** ä»¥æé«˜æ€§èƒ½ï¼š
```vue
export default {
  props: ["page_name"],
  computed: {
    currentComponent() {
      const components = {
        cookie_policy: () => import("@/components/CookiePolicy.vue"),
        terms_of_service: () => import("@/components/TermsOfService.vue"),
        privacy_policy: () => import("@/components/PrivacyPolicy.vue"),
      };
      return components[this.page_name] || (() => import("@/components/CookiePolicy.vue"));
    },
  },
};
```
è¿™æ · Vue åªä¼šåœ¨éœ€è¦æ—¶æ‰åŠ è½½å¯¹åº”çš„ç»„ä»¶ï¼Œè€Œä¸ä¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰ç»„ä»¶ã€‚

---

### **æ€»ç»“**
âœ… é€šè¿‡ `page_name` æ§åˆ¶ä¸åŒé¡µé¢çš„ç»„ä»¶æ¸²æŸ“  
âœ… ä»£ç ç®€æ´ï¼Œæ— éœ€é¢å¤–çš„è·¯ç”±é…ç½®  
âœ… æ”¯æŒåŠ¨æ€æ‰©å±•ï¼Œåªéœ€åœ¨ `WelcomePage.vue` é‡Œæ·»åŠ æ–°ç»„ä»¶  
âœ… å¯ä»¥ç»“åˆ `import()` è¿›è¡Œ **æŒ‰éœ€åŠ è½½** æé«˜æ€§èƒ½  

è¿™ç§æ–¹æ³•åœ¨**å•ä¸ªè·¯ç”±ä¸‹ç®¡ç†å¤šä¸ªé¡µé¢**ï¼Œæ˜¯ Vue åŠ¨æ€è·¯ç”±ç®¡ç†çš„å¸¸è§æ–¹å¼ï¼ğŸš€


éœ€è¦æ³¨æ„: åœ¨ router ä¸­, å¿…é¡»é‡‡ç”¨ () => import() çš„å½¢å¼, è€Œä¸èƒ½é‡‡ç”¨ import çš„å½¢å¼, å¦åˆ™åœ¨å®é™…æ„å»ºåä¼šå¤±æ•ˆ: (è¿™æ˜¯ç”±äº import å¾—åˆ°çš„æ˜¯ä¸€ä¸ª Promise) 
```ts
instead of a function that returns a Promise. Did you write "import('./MyPage.vue')" instead of "() => import('./MyPage.vue')" ? This will break in production if not fixed.
```



## defineAsyncComponent çš„ä½¿ç”¨

ä½ çš„ä»£ç çš„é—®é¢˜åœ¨äº `all_pages` å­˜å‚¨çš„æ˜¯ **æ‡’åŠ è½½çš„åŠ¨æ€å¯¼å…¥å‡½æ•°**ï¼ˆ`() => import(...)`ï¼‰ï¼Œä½†æ˜¯ `current_page` ç›´æ¥è¿”å›äº†è¿™ä¸ªå‡½æ•°çš„ **è¿”å›å€¼**ï¼ˆä¸€ä¸ª `Promise`ï¼‰ï¼Œè€Œ Vue ç»„ä»¶éœ€è¦çš„æ˜¯ **ä¸€ä¸ªå®é™…çš„ç»„ä»¶å¯¹è±¡**ï¼Œè€Œä¸æ˜¯ `Promise`ã€‚

---

### **ä¿®æ­£æ–¹æ³•**

1. **Vue ç»„ä»¶çš„ `component` éœ€è¦çš„æ˜¯ä¸€ä¸ªå®é™…çš„ç»„ä»¶å¯¹è±¡**ï¼Œä½† `import()` è¿”å›çš„æ˜¯ `Promise`ï¼Œæ‰€ä»¥éœ€è¦ç”¨ `defineAsyncComponent()` å¤„ç†ã€‚
2. **ä¿®æ­£ `computed` å±æ€§**ï¼Œç¡®ä¿è¿”å›çš„æ˜¯ Vue ç»„ä»¶ï¼Œè€Œä¸æ˜¯ `Promise`ã€‚

---

### **ä¿®æ­£åçš„ä»£ç **

```vue
<template lang="html">
    <div class="rules-collection">
        <component :is="current_page"></component>
    </div>
</template>

<script lang="ts">
import { defineComponent, defineAsyncComponent } from "vue";

export default defineComponent({
    name: "RulesIndex",
    components: {},
    props: ["page_name"],
    data() {
        return {
            all_pages: {
                main: defineAsyncComponent(() => import("@pages/rules/rules_main.vue")),
                privacy: defineAsyncComponent(() => import("@pages/rules/rules_privacy.vue")),
                cookie: defineAsyncComponent(() => import("@pages/rules/rules_cookie.vue")),
            },
        };
    },
    computed: {
        current_page(): any {
            return this.all_pages[this.page_name] || this.all_pages.main;
        },
    },
});
</script>
```

---

### **æ”¹è¿›çš„åœ°æ–¹**

1. **ä½¿ç”¨ `defineAsyncComponent()`**
    - Vue éœ€è¦çš„æ˜¯ **ç»„ä»¶å¯¹è±¡**ï¼Œä½† `import()` è¿”å›çš„æ˜¯ `Promise`ï¼Œæ‰€ä»¥ç”¨ `defineAsyncComponent()` å¤„ç†å¼‚æ­¥åŠ è½½ã€‚
2. **ä¿®æ­£ `computed` é€»è¾‘**
    - ç›´æ¥è¿”å› `this.all_pages[this.page_name] || this.all_pages.main`ï¼Œé˜²æ­¢ `page_name` ä¸å­˜åœ¨æ—¶æŠ¥é”™ã€‚

---

### **æœ€ç»ˆæ•ˆæœ**

âœ… è®¿é—® `/rules/main` **æ­£ç¡®åŠ è½½** `rules_main.vue`  
âœ… è®¿é—® `/rules/privacy` **æ­£ç¡®åŠ è½½** `rules_privacy.vue`  
âœ… è®¿é—® `/rules/cookie` **æ­£ç¡®åŠ è½½** `rules_cookie.vue`  
âœ… è®¿é—® `/rules/unknown` **é»˜è®¤åŠ è½½** `rules_main.vue`


éœ€è¦è¯´æ˜ï¼Œ å¦‚æœä»…ä»…é‡‡ç”¨ defineAsyncComponent, Vue 3 ä¼š**é”™è¯¯åœ°å°†å¼‚æ­¥ç»„ä»¶ï¼ˆ`AsyncComponentWrapper`ï¼‰å˜æˆäº†å“åº”å¼å¯¹è±¡**ï¼Œå¯¼è‡´æ€§èƒ½é—®é¢˜å’Œè­¦å‘Šã€‚

---

### **ğŸš€ è§£å†³æ–¹æ¡ˆ**

ä½¿ç”¨ `markRaw()` é¿å… Vue 3 **ä¸å¿…è¦åœ°è®©å¼‚æ­¥ç»„ä»¶å˜æˆå“åº”å¼**ã€‚

#### **âœ… ä¿®æ­£ä»£ç **

```vue
<template lang="html">
    <div class="rules-collection">
        <component :is="current_page"></component>
    </div>
</template>

<script lang="ts">
import { defineComponent, defineAsyncComponent, markRaw } from "vue";

export default defineComponent({
    name: "RulesIndex",
    components: {},
    props: ["page_name"],
    data() {
        return {
            all_pages: {
                main: markRaw(defineAsyncComponent(() => import("@pages/rules/rules_main.vue"))),
                privacy: markRaw(defineAsyncComponent(() => import("@pages/rules/rules_privacy.vue"))),
                cookie: markRaw(defineAsyncComponent(() => import("@pages/rules/rules_cookie.vue"))),
            },
        };
    },
    computed: {
        current_page(): any {
            return this.all_pages[this.page_name] || this.all_pages.main;
        },
    },
});
</script>
```

### **ğŸ” ä¸ºä»€ä¹ˆ `markRaw()` è§£å†³é—®é¢˜ï¼Ÿ**

- Vue 3 é»˜è®¤ä¼šæŠŠ `data()` é‡Œçš„å¯¹è±¡å˜æˆ **å“åº”å¼å¯¹è±¡**ã€‚
- `defineAsyncComponent()` è¿”å›çš„æ˜¯ **ç»„ä»¶å¯¹è±¡**ï¼ŒVue **ä¸åº”è¯¥**æŠŠå®ƒå˜æˆå“åº”å¼å¯¹è±¡ã€‚
- `markRaw()` å‘Šè¯‰ Vueï¼š**è¿™ä¸ªå¯¹è±¡ä¸éœ€è¦å˜æˆå“åº”å¼å¯¹è±¡**ï¼Œæé«˜æ€§èƒ½å¹¶é¿å… Vue Warnã€‚

### **ğŸ¯ ä¿®æ­£åçš„è¡Œä¸º**
âœ… **`rules_main.vue`ã€`rules_privacy.vue`ã€`rules_cookie.vue` æ­£ç¡®åŠ è½½**  
âœ… **Vue ä¸ä¼šå†å‘å‡º `[Vue warn]` è­¦å‘Š**  
âœ… **é¡µé¢åˆ‡æ¢æ—¶ä¸ä¼šæœ‰é¢å¤–çš„æ€§èƒ½æŸè€—**

è¿™ä¸ªæ–¹æ³•æ˜¯ **å®˜æ–¹æ¨èçš„è§£å†³æ–¹æ¡ˆ**ï¼ ğŸš€
