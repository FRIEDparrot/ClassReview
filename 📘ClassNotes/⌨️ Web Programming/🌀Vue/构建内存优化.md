

## CSS å†…å­˜ä¼˜åŒ–
é¦–å…ˆå¯ä»¥é‡‡ç”¨ : 
```sh
sudo npm install autoprefixer  @fullhuman/postcss-purgecss
sudo npm install postcss --save-dev
```

å…¶ä¸­:
- `autoprefixer`ï¼šè‡ªåŠ¨ä¸º CSS æ·»åŠ ä¾›åº”å•†å‰ç¼€ï¼ˆå¦‚ `-webkit-`ã€`-moz-` ç­‰ï¼‰ï¼Œæé«˜æµè§ˆå™¨å…¼å®¹æ€§ã€‚
- `@fullhuman/postcss-purgecss`ï¼šç”¨äºç§»é™¤æœªä½¿ç”¨çš„ CSSï¼Œä»¥å‡å°æ„å»ºåæ–‡ä»¶çš„å¤§å°ã€‚


åœ¨ vite_config.js ä¸­é‡‡ç”¨: 
```js 
import autoprefixer from "autoprefixer";
import purgecss from "@fullhuman/postcss-purgecss";

const purgecss = purgecssModule.default || purgecssModule; // handle both CommonJS and ES modules 

export default defineConfig({
    css: {
        postcss: {
            plugins: [
                autoprefixer(),
                purgecss({
                    content: ["./index.html", "./src/**/*.{js,ts,vue}"],
                    safelist: {
                        standard: [
                            "active", "fade-in", "fade-out", "hidden", "show",  // ä½ çš„åŠ¨æ€ç±»å
                        ],
                        deep: [/^v-/], // é˜²æ­¢ Vue ç»„ä»¶çš„ v-* ç±»è¢«åˆ é™¤
                    },
                }),
            ],
        },
    },
});

```

åˆå§‹ npx vite build å¾—åˆ°çš„ css å¦‚ä¸‹: 
```sh
dist/assets/registerPage-BJlDQy1A.css              0.07 kB â”‚ gzip:   0.09 kB
dist/assets/index-HrHHAygK.css                   471.89 kB â”‚ gzip:  60.57 kB
```

ä¼˜åŒ–åå¯ä»¥å‡å°‘å‡ ä¹ä¸€åŠç©ºé—´
```sh
dist/assets/registerPage-BJlDQy1A.css              0.07 kB â”‚ gzip:   0.09 kB
dist/assets/index-D-N5vK9H.css                   226.66 kB â”‚ gzip:  31.59 kB
```


éœ€è¦è¯´æ˜, `@fullhuman/postcss-purgecss` çš„ä½œç”¨æ˜¯ **åˆ é™¤æœªä½¿ç”¨çš„ CSS**ï¼Œä½†å®ƒå¯èƒ½ä¼šé”™è¯¯åœ°åˆ é™¤ **åŠ¨æ€ CSSï¼ˆå¦‚ `v-if`ã€`v-bind:class`ã€GSAP åŠ¨ç”»ç±»ç­‰ï¼‰**ï¼Œå¯¼è‡´æ ·å¼ä¸¢å¤±ã€‚å› æ­¤å¦‚æœç›´æ¥é‡‡ç”¨ 
```js
plugins: [
	autoprefixer(),
	purgecss({
		content: ["./index.html", "./src/**/*.{js,ts,vue}"],
	}),
],
```
æ—¶ä¼šå¯¼è‡´å¤§é‡æ ·å¼ä¸¢å¤±, ä½ éœ€è¦å‘Šè¯‰ PurgeCSS **å“ªäº› CSS ä¸èƒ½è¢«åˆ é™¤**ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

### **æ–¹æ³• 1ï¼šæ·»åŠ  `safelist` ä¿æŠ¤åŠ¨æ€ç±»**

å¦‚æœä½ çš„ CSS æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼ˆå¦‚ Vue `v-bind:class`ã€GSAP åŠ¨ç”»ï¼‰ï¼Œä½ å¯ä»¥ä½¿ç”¨ `safelist` é˜²æ­¢ PurgeCSS åˆ é™¤è¿™äº›ç±»ï¼š

```js
import { defineConfig } from "vite";
import autoprefixer from "autoprefixer";
import purgecssModule from "@fullhuman/postcss-purgecss";

const purgecss = purgecssModule.default || purgecssModule;

export default defineConfig({
    css: {
        postcss: {
            plugins: [
                autoprefixer(),
                purgecss({
                    content: ["./index.html", "./src/**/*.{js,ts,vue}"],
                    safelist: {
                        standard: [
                            "active", "fade-in", "fade-out", "hidden", "show",  // ä½ çš„åŠ¨æ€ç±»å
                        ],
                        deep: [/^v-/], // é˜²æ­¢ Vue ç»„ä»¶çš„ v-* ç±»è¢«åˆ é™¤
                    },
                }),
            ],
        },
    },
});
```

**`safelist` å‚æ•°è§£é‡Šï¼š**
- `standard`ï¼šæ˜¾å¼ä¿ç•™æŒ‡å®šçš„ CSS ç±»ï¼ˆæ‰‹åŠ¨æ·»åŠ ï¼‰ã€‚
- `deep`ï¼šä¿ç•™ **æ­£åˆ™åŒ¹é…** çš„æ‰€æœ‰ç±»ï¼ˆå¦‚ `v-` å¼€å¤´çš„ Vue æŒ‡ä»¤ç±»ï¼‰ã€‚

### **æ–¹æ³• 2ï¼šç¡®ä¿ CSS é€‰æ‹©å™¨æ­£ç¡®åŒ¹é…**

PurgeCSS åªä¼šä¿ç•™ `content` ç›®å½•ä¸‹çš„ `.html`, `.vue`, `.js`, `.ts` æ–‡ä»¶ **æ˜ç¡®ä½¿ç”¨çš„ CSS ç±»**ï¼Œå¦‚æœæŸäº›ç±»æ˜¯ **åŠ¨æ€ç”Ÿæˆçš„**ï¼ˆå¦‚ Vue ç»‘å®š `class`ï¼‰ï¼ŒPurgeCSS **å¯èƒ½æ— æ³•æ£€æµ‹åˆ°**ã€‚

#### **å¦‚ä½•å¤„ç†ï¼Ÿ**

å¦‚æœä½ æœ‰ï¼š

```vue
<template>
    <div :class="{ 'hidden': !isVisible, 'fade-in': isVisible }">
        Hello World
    </div>
</template>
```

PurgeCSS å¯èƒ½ **è¯¯åˆ  `hidden` å’Œ `fade-in`**ï¼Œå› ä¸ºå®ƒä»¬åœ¨ `class="{}` é‡Œ **æ˜¯åŠ¨æ€çš„**ï¼ŒPurgeCSS **æ— æ³•é™æ€åˆ†æ**ã€‚

#### **è§£å†³æ–¹æ¡ˆ**

å¯ä»¥ä½¿ç”¨ **`safelist` ä¿æŠ¤å®ƒä»¬**ï¼š

```js
safelist: ["hidden", "fade-in"],
```

### **æ–¹æ³• 3ï¼šè°ƒè¯• PurgeCSS åˆ é™¤çš„ CSS**

ä½ å¯ä»¥è®© PurgeCSS **åªè¾“å‡ºè¢«åˆ é™¤çš„å†…å®¹**ï¼Œè¿™æ ·å°±èƒ½çœ‹åˆ°å“ªäº›ç±»è¢«åˆ æ‰äº†ï¼š

```sh
NODE_ENV=production npm run build --verbose
```

æˆ–è€…ä½ å¯ä»¥ **ç¦ç”¨ PurgeCSS**ï¼Œç„¶åæŸ¥çœ‹æœ€ç»ˆçš„ `dist` ç›®å½•é‡Œçš„ `index.css`ï¼š

```sh
npx vite build
```

å¦‚æœä½ å‘ç°æŸäº›ç±»è¢«åˆ é™¤äº†ï¼Œå°è¯•æ‰‹åŠ¨ `safelist` æˆ–è°ƒæ•´ `content` è§„åˆ™ã€‚

---

### **æ–¹æ³• 4ï¼šç¦ç”¨ PurgeCSS ä»…åœ¨ `development` æœŸé—´**

å¦‚æœä½ åªæƒ³åœ¨ `production` ä¸‹å¯ç”¨ PurgeCSSï¼Œå¯ä»¥è¿™æ ·ï¼š

```js
const isProduction = process.env.NODE_ENV === "production";

export default defineConfig({
    css: {
        postcss: {
            plugins: [
                autoprefixer(),
                isProduction &&
                    purgecss({
                        content: ["./index.html", "./src/**/*.{js,ts,vue}"],
                        safelist: ["active", "fade-in", "fade-out"],
                    }),
            ].filter(Boolean),
        },
    },
});
```

è¿™æ ·ï¼Œ**`npm run dev` ä¸ä¼šæ¸…é™¤ CSSï¼Œä½† `npm run build` ä¼šä¼˜åŒ– CSS**ã€‚

---

## **æ€»ç»“**

### âœ… **æ¨èçš„æœ€ä½³å®è·µ**

1. **æ‰‹åŠ¨ `safelist` ä¿æŠ¤åŠ¨æ€ç±»**ï¼ˆ`safelist: ["hidden", "fade-in"]`ï¼‰ã€‚
2. **ä½¿ç”¨ `deep: [/^v-/]` ä¿æŠ¤ Vue ç›¸å…³çš„ç±»**ã€‚
3. **æ£€æŸ¥ `.vue` å’Œ `.js` æ–‡ä»¶ä¸­æ˜¯å¦æ­£ç¡®å¼•ç”¨äº†ç±»**ã€‚
4. **è°ƒè¯• PurgeCSSï¼ŒæŸ¥çœ‹å“ªäº›ç±»è¢«åˆ æ‰äº†**ï¼ˆ`NODE_ENV=production npm run build --verbose`ï¼‰ã€‚
5. **ä»…åœ¨ `production` ç¯å¢ƒå¯ç”¨ PurgeCSS**ï¼Œé¿å…å½±å“å¼€å‘ã€‚

---

è¿™æ ·ä¿®æ”¹åï¼Œä½ çš„æ ·å¼åº”è¯¥ä¸ä¼šå†è¢«è¯¯åˆ äº†ï¼ğŸš€