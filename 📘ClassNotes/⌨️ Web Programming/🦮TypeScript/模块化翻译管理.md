å¯ä»¥é€šè¿‡å°†ç¿»è¯‘æ–‡ä»¶åˆ†æˆå¤šä¸ª JSON æ–‡ä»¶ï¼Œåˆ†åˆ«åŠ è½½ä¸åŒé¡µé¢æ‰€éœ€çš„ç¿»è¯‘èµ„æºï¼ŒåŒæ—¶è®© `app.use` åªåº”ç”¨å…¨å±€é€šç”¨çš„ç¿»è¯‘èµ„æºã€‚è¿™ç§æ–¹æ³•å¯ä»¥æœ‰æ•ˆå‡å°‘æ¯ä¸ªé¡µé¢åŠ è½½çš„ç¿»è¯‘æ•°æ®é‡ï¼ŒåŒæ—¶ä¿æŒæ¨¡å—åŒ–å’Œçµæ´»æ€§ã€‚

ä»¥ä¸‹æ˜¯å®ç°æ­¥éª¤ï¼š

---

### 1. **ç›®å½•ç»“æ„è®¾è®¡**

å°†ç¿»è¯‘æ–‡ä»¶åˆ†æˆå…¨å±€é€šç”¨å’Œé¡µé¢ç‰¹å®šçš„ä¸¤éƒ¨åˆ†ï¼Œä¾‹å¦‚ï¼š

```
src/
â”œâ”€â”€ i18n/
â”‚   â”œâ”€â”€ common.json             # é€šç”¨ç¿»è¯‘
â”‚   â”œâ”€â”€ home.json               # Home é¡µé¢ç¿»è¯‘
â”‚   â”œâ”€â”€ about.json              # About é¡µé¢ç¿»è¯‘
```

### 2. **å…¨å±€é…ç½® i18n**

åœ¨ `main.js` ä¸­åˆå§‹åŒ– `i18n`ï¼Œå¹¶åªåŠ è½½é€šç”¨ç¿»è¯‘æ–‡ä»¶ã€‚

```javascript
import { createApp } from 'vue';
import { createI18n } from 'vue-i18n';
import App from './App.vue';
import common from './i18n/common.json';

const i18n = createI18n({
  locale: 'en', // é»˜è®¤è¯­è¨€
  messages: {
    en: common,
    zh: {} // å¦‚æœæœ‰ä¸­æ–‡é€šç”¨ç¿»è¯‘ï¼Œå¯ä»¥åœ¨è¿™é‡ŒåŠ è½½
  }
});

const app = createApp(App);
app.use(i18n);
app.mount('#app');
```

### 3. **æŒ‰éœ€åŠ è½½é¡µé¢ç¿»è¯‘æ–‡ä»¶**

åœ¨æ¯ä¸ªé¡µé¢ç»„ä»¶ä¸­åŠ¨æ€åŠ è½½å¯¹åº”çš„ç¿»è¯‘æ–‡ä»¶ï¼Œå¹¶å°†å…¶åˆå¹¶åˆ° `i18n` å®ä¾‹çš„ `messages` ä¸­ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯, å¦‚æœå¯¼å…¥çš„è·¯å¾„æ˜¯ä¸å®šçš„æˆ–è€…éœ€è¦å­—ç¬¦ä¸²è¿›è¡ŒåŠ è½½, åˆ™éœ€è¦é‡‡ç”¨åŠ¨æ€æ¨¡å—å¯¼å…¥è¿›è¡Œå®ç°ã€‚å‚è€ƒ[[ğŸ“˜ClassNotes/âŒ¨ï¸ Web Programming/ğŸŒ€Vue/åŠ¨æ€å¯¼å…¥]]

#### ç¤ºä¾‹ï¼šHome.vue

```vue
<script>
import { useI18n } from 'vue-i18n';

export default {
  name: 'Home',
  async setup() {
    const { locale, messages } = useI18n();

    // åŠ¨æ€åŠ è½½ Home é¡µé¢ç¿»è¯‘
    const homeMessages = await import('../i18n/home.json');

    // åˆå¹¶ç¿»è¯‘å†…å®¹
    messages.value[locale.value] = {
      ...messages.value[locale.value],
      ...homeMessages.default
    };
  }
};
</script>

<template>
  <div>
    <h1>{{ $t('home.title') }}</h1>
    <p>{{ $t('home.description') }}</p>
  </div>
</template>
```

---

### 4. **ä¿æŒå…¨å±€å’Œå±€éƒ¨ç¿»è¯‘çš„éš”ç¦»**

ä½¿ç”¨å‘½åç©ºé—´é˜²æ­¢é”®åå†²çªã€‚ä¾‹å¦‚ï¼Œåœ¨ `home.json` ä¸­çš„ç¿»è¯‘å†…å®¹ä½¿ç”¨ `home` ä½œä¸ºå‰ç¼€ï¼š

```json
{
  "home": {
    "title": "Welcome to the Home Page",
    "description": "This is the home page description."
  }
}
```

åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨æ—¶ï¼š

```html
<h1>{{ $t('home.title') }}</h1>
```

---

### 5. **ä¼˜åŒ–ï¼šç¼“å­˜å·²åŠ è½½çš„ç¿»è¯‘**

ä¸ºé¿å…æ¯æ¬¡è¿›å…¥é¡µé¢éƒ½é‡æ–°åŠ è½½ç¿»è¯‘æ–‡ä»¶ï¼Œå¯ä»¥å¼•å…¥ç®€å•çš„ç¼“å­˜æœºåˆ¶ã€‚ä¾‹å¦‚ï¼š

```javascript
const loadedLanguages = new Set();

async function loadPageTranslation(page) {
  if (!loadedLanguages.has(page)) {
    const messages = await import(`../i18n/${page}.json`);
    i18n.global.setLocaleMessage(i18n.global.locale, {
      ...i18n.global.getLocaleMessage(i18n.global.locale),
      ...messages.default
    });
    loadedLanguages.add(page);
  }
}
```

åœ¨é¡µé¢ç»„ä»¶ä¸­è°ƒç”¨ï¼š

```javascript
import { loadPageTranslation } from '../utils/i18nLoader';

export default {
  async setup() {
    await loadPageTranslation('home');
  }
};
```

---

### 6. **ä»…ä½¿ç”¨å…±ç”¨çš„ç¿»è¯‘**

å¦‚æœæŸäº›é¡µé¢åªéœ€è¦é€šç”¨ç¿»è¯‘ï¼Œåˆ™æ— éœ€åŠ¨æ€åŠ è½½é¢å¤–çš„æ–‡ä»¶ï¼Œè¿™æ · `app.use` ä¸­çš„ç¿»è¯‘å³å¯æ»¡è¶³éœ€æ±‚ã€‚

---

### æ€»ç»“

è¿™ç§æŒ‰éœ€åŠ è½½çš„æ–¹æ³•æœ‰æ•ˆè§£å†³äº†ä»¥ä¸‹é—®é¢˜ï¼š

1. **å‡å°‘ç¿»è¯‘æ–‡ä»¶çš„å¤§å°**ï¼šä»…åŠ è½½é¡µé¢éœ€è¦çš„ç¿»è¯‘å†…å®¹ã€‚
2. **æ¨¡å—åŒ–ç®¡ç†**ï¼šç¿»è¯‘æ–‡ä»¶æ˜“äºç»´æŠ¤ã€‚
3. **çµæ´»æ€§**ï¼šå…¨å±€ç¿»è¯‘å’Œå±€éƒ¨ç¿»è¯‘å¯ä»¥å…±å­˜ã€‚


1. **ä½¿ç”¨ `import` å°†é€»è¾‘æå–åˆ°å¤–éƒ¨æ¨¡å—**ï¼šä½ å¯ä»¥å°†ç¿»è¯‘é€»è¾‘æ”¾åˆ°å•ç‹¬çš„ `.ts` æ–‡ä»¶ä¸­ï¼Œå¹¶åœ¨ä¸»é¡µé¢æ–‡ä»¶ä¸­å¯¼å…¥è¯¥é€»è¾‘ã€‚
    
2. **å°†é€»è¾‘å°è£…æˆä¸€ä¸ªè‡ªå®šä¹‰ç»„åˆå¼å‡½æ•°**ï¼šå¦‚æœé€»è¾‘ç›¸å¯¹ç‹¬ç«‹ï¼Œå¯ä»¥å°†å…¶å°è£…æˆä¸€ä¸ªè‡ªå®šä¹‰çš„ç»„åˆå¼å‡½æ•°ï¼Œå¹¶åœ¨éœ€è¦çš„åœ°æ–¹ä½¿ç”¨ã€‚
    

### è§£å†³æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ `import` å¯¼å…¥å¤–éƒ¨æ–‡ä»¶çš„ç¿»è¯‘é€»è¾‘

ä½ å¯ä»¥å°†ç¿»è¯‘çš„é€»è¾‘æå–åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨ä¸»ç»„ä»¶ä¸­å¯¼å…¥å®ƒï¼Œå¹¶ä½¿ç”¨å®ƒã€‚

éœ€è¦æ³¨æ„çš„æ˜¯, <b><mark style="background: transparent; color: orange">å¯¼å…¥è¯¥æ¨¡å—çš„éƒ¨åˆ†å¿…é¡»åœ¨ setup ä¸­è¿›è¡Œå¯¼å…¥ , è¿™æ˜¯ç”±äº i18n éœ€è¦ setup çš„ä¸Šä¸‹æ–‡æ”¯æŒ</mark></b>

### æ­¥éª¤ï¼š

#### 1. åˆ›å»ºä¸€ä¸ªå¤–éƒ¨æ–‡ä»¶ `welcome_translate.ts`

åœ¨ `src` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„ TypeScript æ–‡ä»¶ `welcome_translate.ts`ï¼Œå¹¶å°†ä½ çš„ç¿»è¯‘é€»è¾‘æ”¾å…¥å…¶ä¸­ã€‚

```typescript
// welcome_translate.ts
import { useI18n } from "vue-i18n";
import { watchEffect } from "vue";

const loadedLanguages = new Set(); // Set to track loaded languages

export function useWelcomeTranslation() {
  const { locale, messages } = useI18n();

  watchEffect(async () => {
    const langcode = locale.value; // Get current locale code
    if (!loadedLanguages.has(langcode)) {
      const lang_file = `@locales/${langcode}/welcome.json`; // Path to locale-specific file
      try {
        const msg = await import(lang_file); // Dynamically import the language file
        // Merge new messages with the existing ones
        messages.value[langcode] = {
          ...messages.value[langcode],
          ...msg.default,
        };
        loadedLanguages.add(langcode); // Mark the language as loaded
      } catch (err) {
        console.error(`Failed to load translation for ${langcode}:`, err);
      }
    }
  });

  return {
    loadedLanguages,
  };
}
```

#### 2. åœ¨ `page_welcome.ts` ä¸­ä½¿ç”¨è¯¥ç¿»è¯‘é€»è¾‘

åœ¨ä½ çš„ `page_welcome.ts` æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥ç›´æ¥å¯¼å…¥å¹¶ä½¿ç”¨ `useWelcomeTranslation` å‡½æ•°ï¼Œè€Œä¸éœ€è¦å°†ç¿»è¯‘é€»è¾‘å†™åœ¨ `setup()` å†…ã€‚

```typescript
// page_welcome.ts
import { defineComponent } from "vue";
import { useI18n } from "vue-i18n";
import { useWelcomeTranslation } from "@/path/to/welcome_translate"; // å¯¼å…¥ç¿»è¯‘é€»è¾‘

export default defineComponent({
  name: "PageWelcome",
  setup() {
    const { locale } = useI18n();
    const { loadedLanguages } = useWelcomeTranslation(); // è°ƒç”¨è‡ªå®šä¹‰ç»„åˆå¼å‡½æ•°

    // è¿™é‡Œå¯ä»¥è¿”å›éœ€è¦åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨çš„å˜é‡
    return {
      locale,
      loadedLanguages,
    };
  },
});
```

### æ­¥éª¤ 3ï¼šä¸»ç»„ä»¶æ¨¡æ¿ä¸­ä½¿ç”¨ç¿»è¯‘

```vue
<template>
  <div>
    <h1>{{ $t("welcome.title") }}</h1>
    <p>{{ $t("welcome.description") }}</p>
  </div>
</template>

<script setup>
import { useI18n } from "vue-i18n";
import { useWelcomeTranslation } from "@/path/to/welcome_translate";

const { locale } = useI18n();
const { loadedLanguages } = useWelcomeTranslation();
</script>
```

### è§£é‡Šï¼š

1. **`welcome_translate.ts`**ï¼šæˆ‘ä»¬å°†ç¿»è¯‘çš„é€»è¾‘æå–åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€ä¸ª `useWelcomeTranslation` å‡½æ•°ï¼ŒåŒ…å«äº†ç¿»è¯‘åŠ è½½å’Œåˆå¹¶çš„é€»è¾‘ã€‚
2. **`page_welcome.ts`**ï¼šåœ¨é¡µé¢ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥å¹¶ä½¿ç”¨äº† `useWelcomeTranslation` å‡½æ•°ï¼ŒåŠ è½½ç¿»è¯‘å¹¶ç¡®ä¿è¯­è¨€æ–‡ä»¶ä¸ä¼šé‡å¤åŠ è½½ã€‚
3. **æ¨¡æ¿**ï¼šæ¨¡æ¿ä¸­ä½¿ç”¨äº† Vue I18n æä¾›çš„ `$t` æ–¹æ³•æ¥æ˜¾ç¤ºç¿»è¯‘å†…å®¹ã€‚

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œç¿»è¯‘é€»è¾‘è¢«ç‹¬ç«‹åˆ°ä¸€ä¸ªå¤–éƒ¨æ–‡ä»¶ï¼Œä½ å¯ä»¥åœ¨å¤šä¸ªç»„ä»¶ä¸­å¤ç”¨å®ƒï¼Œä¹Ÿé¿å…äº†åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ç¼–å†™è¿‡å¤šçš„é€»è¾‘ã€‚

### è§£å†³æ–¹æ¡ˆ 2ï¼šå°†ç¿»è¯‘é€»è¾‘å°è£…ä¸ºè‡ªå®šä¹‰ç»„åˆå¼å‡½æ•°

å¦‚æœä½ å¸Œæœ›å°è£…çš„é€»è¾‘æ›´åŠ é€šç”¨ï¼Œå¯ä»¥è€ƒè™‘å°†å®ƒå°è£…ä¸ºä¸€ä¸ªç»„åˆå¼å‡½æ•°ï¼ˆComposition Functionï¼‰ã€‚è¿™ä¼šä½¿ä½ çš„ä»£ç æ›´ç®€æ´ï¼Œé€»è¾‘æ›´å®¹æ˜“å¤ç”¨ã€‚

```typescript
// useTranslation.ts
import { useI18n } from "vue-i18n";
import { watchEffect } from "vue";

const loadedLanguages = new Set();

export function useTranslation() {
  const { locale, messages } = useI18n();

  watchEffect(async () => {
    const langcode = locale.value;
    if (!loadedLanguages.has(langcode)) {
      const lang_file = `@locales/${langcode}/welcome.json`;
      try {
        const msg = await import(lang_file);
        messages.value[langcode] = {
          ...messages.value[langcode],
          ...msg.default,
        };
        loadedLanguages.add(langcode);
      } catch (err) {
        console.error(`Failed to load translation for ${langcode}:`, err);
      }
    }
  });

  return { loadedLanguages };
}
```

ç„¶ååœ¨ `page_welcome.ts` ä¸­ä½¿ç”¨å®ƒï¼š

```typescript
// page_welcome.ts
import { defineComponent } from "vue";
import { useI18n } from "vue-i18n";
import { useTranslation } from "@/path/to/useTranslation";

export default defineComponent({
  name: "PageWelcome",
  setup() {
    const { locale } = useI18n();
    const { loadedLanguages } = useTranslation(); // ä½¿ç”¨è‡ªå®šä¹‰ç»„åˆå¼å‡½æ•°

    return {
      locale,
      loadedLanguages,
    };
  },
});
```

### æ€»ç»“ï¼š

- ä½ å¯ä»¥å°†é€»è¾‘æå–åˆ°ä¸€ä¸ªå¤–éƒ¨çš„ TypeScript æ–‡ä»¶ï¼ˆå¦‚ `welcome_translate.ts`ï¼‰ï¼Œå¹¶é€šè¿‡ `import` åœ¨éœ€è¦çš„ç»„ä»¶ä¸­ä½¿ç”¨ã€‚
- ä½¿ç”¨ `watchEffect` æ¥åŠ¨æ€åŠ è½½å’Œåˆå¹¶è¯­è¨€ç¿»è¯‘æ–‡ä»¶ï¼Œå¹¶é¿å…é‡å¤åŠ è½½ã€‚
- å°†ç¿»è¯‘çš„é€»è¾‘å°è£…æˆä¸€ä¸ªç»„åˆå¼å‡½æ•°ï¼Œä½¿å¾—ä»£ç æ›´ç®€æ´ä¸”å¯å¤ç”¨ã€‚