## ä¸€ã€Promise å¯¹è±¡
### (1) Promise å¯¹è±¡åŸºç¡€æ¦‚å¿µ
`Promise` æ˜¯ JavaScript ä¸­çš„ä¸€ç§<b><mark style="background: transparent; color: orange">ç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œçš„å¯¹è±¡</mark></b>ã€‚å®ƒæä¾›äº†ä¸€ç§ä¼˜é›…çš„æ–¹å¼æ¥ç®¡ç†å¼‚æ­¥ä»»åŠ¡ï¼Œæ¯”å¦‚ä»æœåŠ¡å™¨è·å–æ•°æ®ã€åŠ è½½èµ„æºã€å®šæ—¶æ“ä½œç­‰ã€‚`Promise` ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„æœ€ç»ˆç»“æœï¼Œæœ‰ä¸‰ç§å¯èƒ½çš„çŠ¶æ€ï¼š

1. **Pendingï¼ˆè¿›è¡Œä¸­ï¼‰**ï¼šåˆå§‹çŠ¶æ€ï¼Œæ“ä½œå°šæœªå®Œæˆã€‚
2. **Fulfilledï¼ˆå·²å®Œæˆï¼‰**ï¼šæ“ä½œæˆåŠŸå®Œæˆï¼Œå¹¶è¿”å›ç»“æœã€‚
3. **Rejectedï¼ˆå·²å¤±è´¥ï¼‰**ï¼šæ“ä½œå¤±è´¥ï¼Œå¹¶è¿”å›åŸå› ï¼ˆé”™è¯¯ï¼‰ã€‚
ä¸€æ—¦ `Promise` çŠ¶æ€ä» `Pending` è½¬æ¢ä¸º `Fulfilled` æˆ– `Rejected`ï¼ŒçŠ¶æ€å°±ä¼šè¢«å†»ç»“ï¼ˆæ— æ³•å†æ¬¡æ”¹å˜ï¼‰ã€‚ 


Promise å¯¹è±¡å‚è€ƒ[js_promise](https://www.w3schools.com/js/js_promise.asp)éƒ¨åˆ†, ä¹Ÿæ˜¯ ES6 å¼•å…¥çš„æ–°çš„å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆ, Promise æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°, èƒ½å¤Ÿ<b><mark style="background: transparent; color: orange">å°è£…å¼‚æ­¥æ“ä½œå‡½æ•°</mark></b>ã€‚
Promise éœ€è¦å®šä¹‰ä¸¤ä¸ªå‡½æ•°, **æˆåŠŸå, ä¼šè°ƒç”¨ myResolve å‡½æ•°å¤„ç†**, è€Œ**å¤±è´¥ä¹‹åä¼šè°ƒç”¨  myReject å‡½æ•°å¤„ç†**; å®é™…ä¸Šæ˜¯åœ¨ Promise ä¸­å®šä¹‰éœ€è¦çš„ä¸¤ä¸ªå‡½æ•°: 
å¯¹äºä»…æƒ³è¦å¤„ç†é”™è¯¯çŠ¶æ€çš„æƒ…å†µ, å¯ä»¥é‡‡ç”¨ promise-catch   
```js
const promise = new Promise((resolve, reject) => { 
  // ç¬¬ä¸€ä¸ªæ˜¯resolve å‡½æ•°, ç¬¬äºŒä¸ªæ˜¯ reject å‡½æ•°
  // å¼‚æ­¥æ“ä½œ
  const success = true; // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œç»“æœ
  if (success) {
    resolve('æ“ä½œæˆåŠŸ'); // æ“ä½œæˆåŠŸæ—¶è°ƒç”¨ resolve
  } else {
    reject('æ“ä½œå¤±è´¥'); // æ“ä½œå¤±è´¥æ—¶è°ƒç”¨ reject
  }
});
promise
  .then((result) => {
    console.log(result); // æ“ä½œæˆåŠŸæ—¶æ‰§è¡Œ
  })
  .catch((error) => {
    console.error(error); // æ“ä½œå¤±è´¥æ—¶æ‰§è¡Œ
  })
  .finally(() => {
    console.log('æ“ä½œç»“æŸ'); // æ— è®ºæˆåŠŸæˆ–å¤±è´¥éƒ½ä¼šæ‰§è¡Œ
  });
```
ä¸»è¦çš„æ–¹æ³•å‚è€ƒ[Js Promise](https://www.w3schools.com/jsref/jsref_obj_promise.asp), æ–¹æ³•ç½—åˆ—å¦‚ä¸‹:
![[attachments/Pasted image 20241104164532.png]] 

å…¶ä¸­, ==error éƒ¨åˆ†æ˜¯å¯ä»¥çœç•¥çš„== 

### (2) Promise-then è·å–ç»“æœ
then å®é™…ä¸Šæ˜¯ä¸€ç§ç­‰å¾…æœºåˆ¶, å³ç­‰å¾…ä¸€ä¸ª Promise æ‰§è¡Œå®Œæ¯•ä¹‹å, å†å»æ‰§è¡Œ then ä¸­çš„å†…å®¹:

ä¾‹å¦‚åˆ›å»ºä¸€ä¸ªæ¥å£, æœ€ç»ˆ**å¦‚æœæˆåŠŸè°ƒç”¨ resolve,å¤±è´¥è°ƒç”¨ reject**, è€Œç›¸åº”çš„ p.then è·å–åˆ°å“åº”ä¹‹å, ä¼šè¿”å› value æˆ–è€… err, å¯ä»¥åœ¨ then ä¸­æŒ‡å®šä¸åŒçš„å¤„ç†æ–¹å¼: 

è°ƒç”¨ <b><mark style="background: transparent; color: orange">resolve å’Œ reject å®é™…ä¸Šæ˜¯ä¸¤ä¸ª return, resolve æŒ‡å®šæˆåŠŸçš„ return å¯¹è±¡, è€Œ reject æŒ‡å®šå¤±è´¥çš„è¿”å›ä¿¡æ¯</mark></b>ã€‚  åœ¨ JavaScript ä¸­ï¼Œ`Promise` æ˜¯ **ç«‹å³æ‰§è¡Œ** çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦åˆ›å»ºäº† `Promise` å®ä¾‹ï¼Œå®ƒå°±ä¼šç«‹å³å¼€å§‹æ‰§è¡Œå…¶å†…éƒ¨çš„æ‰§è¡Œå™¨å‡½æ•°ï¼ˆ`executor`ï¼‰ï¼Œè€Œä¸æ˜¯ç­‰åˆ°ä½ è°ƒç”¨ `then` æˆ– `catch` æ‰æ‰§è¡Œã€‚è€Œ then ä»…ä»…æ˜¯è·å–è¿”å›ç»“æœã€‚

**è°ƒç”¨ then æ–¹æ³•æ—¶, then æ–¹æ³•è¿”å›ç»“æœä»ç„¶æ˜¯ Promise å¯¹è±¡**(å›è°ƒå‡½æ•°æ‰§è¡Œç»“æœä¸ºvalue è€Œépromiseæ—¶æ˜¯æˆåŠŸçš„) 
```js
// æ¥å£åœ°å€: https://api.apiopen.top/getJoke
const p = new Promise((resolve, reject) => {
    //1. åˆ›å»ºå¯¹è±¡
    const xhr = new XMLHttpRequest();
    //2. åˆå§‹åŒ–
    xhr.open("GET", "https://api.apiopen.top/getJoke");
    //3. å‘é€
    xhr.send();
    //4. ç»‘å®šäº‹ä»¶, å¤„ç†å“åº”ç»“æœ
    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
            //åˆ¤æ–­å“åº”çŠ¶æ€ç  200-299
            if (xhr.status >= 200 && xhr.status < 300) {
                //è¡¨ç¤ºæˆåŠŸ
                resolve(xhr.response);
            } else {
                //å¦‚æœå¤±è´¥
                reject(xhr.status);
            }
        }
    }
});

//  å¯ä»¥ä¸ºå¯¹åº”çš„è¿”å›å€¼æŒ‡å®šå›è°ƒ
p.then(
	function (value) {
	    console.log(value);
	},
	function (err) {
	    console.error(err);
	}
);
```
ç»™å‡ºä»¥ä¸‹çš„å¤šä¸ª then è°ƒç”¨ç¤ºä¾‹:  
```js
//åˆ›å»º promise å¯¹è±¡
const p = new Promise((resolve, reject) => {
    setTimeout(() => {
        resolve("ç”¨æˆ·æ•°æ®");
    }, 1000)
});

//é“¾å¼è°ƒç”¨+ç®­å¤´å‡½æ•°
p.then(value => {
    console.log(value);   // "ç”¨æˆ·æ•°æ®"
    return 'Hello'; // è¿”å›ä¸€ä¸ªæ–°å€¼, ä¼ é€’åˆ°ä¸‹ä¸€ä¸ª then ä¸­
}).then(value => {
    console.log(value);
});
```
ä¸Šè¿°æ–¹æ³•å®é™…ä¸Šæ˜¯è°ƒç”¨äº† promise ä¸€æ¬¡, å³ç¬¬ä¸€ä¸ª promise.then å®é™…ä¸Šè·å–äº†"ç”¨æˆ·æ•°æ®". value ä¼šæå–å…¶ä¸­çš„ Promise è¿”å›å€¼

### (3) å¹¶å‘æ‰§è¡Œä¸æ§åˆ¶é€»è¾‘    
æœ€å¸¸ç”¨çš„éƒ¨åˆ†æœ‰ : 
- **`Promise.all()`**ï¼šç­‰å¾…æ‰€æœ‰ Promise å®Œæˆï¼Œè¿”å›æ‰€æœ‰ç»“æœã€‚
- **`Promise.race()`**ï¼šè¿”å›ç¬¬ä¸€ä¸ªå®Œæˆçš„ Promiseã€‚
- **`Promise.allSettled()`**ï¼šç­‰å¾…æ‰€æœ‰ Promise å®Œæˆï¼Œè¿”å›æ¯ä¸ª Promise çš„çŠ¶æ€ï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰ã€‚
- **`Promise.any()`**ï¼šè¿”å›ç¬¬ä¸€ä¸ªæˆåŠŸçš„ Promiseï¼Œæ‰€æœ‰ Promise éƒ½å¤±è´¥æ—¶æ‰æ‹’ç»ã€‚
- **`Promise.resolve()`**ï¼šè¿”å›ä¸€ä¸ªå·²è§£æï¼ˆresolvedï¼‰çš„ Promiseã€‚
- **`Promise.reject()`**ï¼šè¿”å›ä¸€ä¸ªå·²æ‹’ç»ï¼ˆrejectedï¼‰çš„ Promiseã€‚
- **`Promise.finally()`**ï¼šæ— è®º Promise æˆåŠŸæˆ–å¤±è´¥éƒ½ä¼šæ‰§è¡Œçš„å›è°ƒå‡½æ•°ã€‚
#### 1. é»˜è®¤è¡Œä¸º 
é»˜è®¤è¡Œä¸º:  åœ¨==åˆ›å»ºå¤šä¸ª `Promise` è€Œä¸ä½¿ç”¨ `await` æˆ– `.then()` æ—¶ï¼Œæ‰€æœ‰çš„ `Promise` ä¼šç«‹å³å¯åŠ¨==ï¼Œå„è‡ªçš„å¼‚æ­¥ä»»åŠ¡ä¼š**å¹¶å‘**æ‰§è¡Œï¼ˆå‡ ä¹åŒæ—¶å¼€å§‹ï¼‰ï¼Œç­‰å¾…çš„è¿‡ç¨‹æ˜¯å¹¶è¡Œçš„ã€‚è™½ç„¶å®ƒä»¬çš„æ‰§è¡Œé¡ºåºå¯èƒ½ä¼šå› ä¸ºåˆ›å»ºé¡ºåºè€Œç¨æœ‰ä¸åŒï¼Œä½†å®ƒä»¬æœ¬è´¨ä¸Šä¸ä¼šå½¼æ­¤é˜»å¡ï¼Œå› è€Œä¼šå‘ˆç°å‡ºç±»ä¼¼â€œåŒæ­¥â€æ‰§è¡Œçš„æ•ˆæœ,  ä¾‹å¦‚:
```js
const promise1 = new Promise((resolve) => {
  console.log("Promise 1 started");
  setTimeout(() => {
    console.log("Promise 1 resolved");
    resolve();
  }, 1000);
});

const promise2 = new Promise((resolve) => {
  console.log("Promise 2 started");
  setTimeout(() => {
    console.log("Promise 2 resolved");
    resolve();
  }, 500);
});

console.log("Promises created but not awaited");
```

è¾“å‡ºç»“æœä¸º:
```js
Promise 1 started
Promise 2 started
Promises created but not awaited
Promise 2 resolved
Promise 1 resolved
```

å¦‚æœæ˜¯é€šè¿‡ await, åˆ™ç­‰å¾…å‰ä¸€ä¸ª promise  æ‰§è¡Œå®Œ, å†æ‰§è¡Œä¸‹ä¸€ä¸ª, ä½¿ç”¨ `await` æ—¶ï¼Œ**ä»£ç ä¼šæš‚åœåœ¨ `await` æ‰€åœ¨çš„é‚£ä¸€è¡Œï¼Œç­‰å¾…å¯¹åº”çš„ Promise å®Œæˆåå†ç»§ç»­æ‰§è¡Œä¸‹ä¸€å¥**ã€‚è¿™ä½¿å¾—ä»£ç æ‰§è¡Œçœ‹èµ·æ¥åƒæ˜¯åŒæ­¥çš„ï¼Œä½†å®é™…ä¸Šä»ç„¶æ˜¯éé˜»å¡çš„ã€‚ 
#### 2. Promise.all 

```ts
let dayBackground: HTMLImageElement | null = null; 
let nightBackground: HTMLImageElement | null = null;

asyncc function fun(){
	const [dayBackground, nightBackground] = await Promise.all([
		loadImage(bg_day),
		loadImage(bg_night),
	]);
	// ç»™å¤–éƒ¨å˜é‡èµ‹å€¼ 
}


```
- **`await` å’Œ `try-catch`** æ˜¯åŒæ­¥é£æ ¼è¯­æ³•ï¼Œç›´è§‚ä¸”ç®€æ´ï¼Œæ¨èåœ¨ `async` å‡½æ•°å†…ä½¿ç”¨ã€‚
- **`.then...catch`** æ˜¯å›è°ƒé£æ ¼è¯­æ³•ï¼Œæ›´é€‚åˆä¸ä½¿ç”¨ `async/await` çš„ä»£ç å—ã€‚

#### 3. Promise.race å’Œå¤š Promise ä¼˜å…ˆè¿”å›
`Promise.race` æ˜¯ JavaScript ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨**äºå¤„ç†å¤šä¸ª Promise å¯¹è±¡çš„å¹¶å‘æ‰§è¡Œ**ã€‚å®ƒçš„åŠŸèƒ½æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„ Promiseï¼Œè¯¥ Promise ä¼šåœ¨ä¼ å…¥çš„ Promise ä¸­ç¬¬ä¸€ä¸ªæ”¹å˜çŠ¶æ€ï¼ˆæ— è®ºæ˜¯ fulfilled è¿˜æ˜¯ rejectedï¼‰æ—¶è¢«è§£å†³æˆ–æ‹’ç»ã€‚ 

```javascript
Promise.race(iterable);
```
- **iterable**: ä»»ä½•å¯è¿­ä»£å¯¹è±¡ï¼ˆä¾‹å¦‚æ•°ç»„ï¼‰é‡Œé¢çš„ Promise å¯¹è±¡ã€‚
- è¿”å›ä¸€ä¸ªæ–°çš„ Promiseï¼Œå…¶çŠ¶æ€ä¸é¦–å…ˆæ”¹å˜çŠ¶æ€çš„ Promise çŠ¶æ€ç›¸åŒã€‚
```javascript
const promise1 = new Promise((resolve, reject) => {
  setTimeout(resolve, 100, 'ç¬¬ä¸€');
});
const promise2 = new Promise((resolve, reject) => {
  setTimeout(reject, 50, 'ç¬¬äºŒ');
});
// æ˜¾ç„¶ä¸Šè¿°ä¸¤ä¸ªæ˜¯å¹¶å‘æ‰§è¡Œçš„
Promise.race([promise1, promise2])
  .then((value) => {
    console.log(value); // è¾“å‡º: "ç¬¬ä¸€"ï¼ˆå› ä¸º promise2 å…ˆè¢«æ‹’ç»ï¼Œä½†æ˜¯ promise1 å…ˆè§£å†³ï¼‰
  })
  .catch((error) => {
    console.log(error); // è¾“å‡º: "ç¬¬äºŒ"
  });
```
- `Promise.race` è¿”å›çš„ Promise **åªä¼šä»ç¬¬ä¸€ä¸ªè§£å†³æˆ–æ‹’ç»çš„ Promise ä¸­è·å–å€¼ï¼Œå…¶ä»–çš„ Promise ä¼šç»§ç»­æ‰§è¡Œ**
- **å¦‚æœæ²¡æœ‰ä»»ä½• Promise è¢«è§£å†³æˆ–æ‹’ç»ï¼Œåˆ™è¿”å›çš„ Promise ä¼šå¤„äºæŒ‚èµ·çŠ¶æ€**ã€‚
`Promise.race` ç”¨äºç®¡ç†å¤šä¸ªå¼‚æ­¥æ“ä½œçš„ç«èµ›æƒ…å½¢ï¼Œé€šå¸¸åœ¨ç½‘ç»œè¯·æ±‚çš„åœºæ™¯ä¸­ä½¿ç”¨ï¼Œå¦‚å®ç°è¶…æ—¶æœºåˆ¶ç­‰ã€‚

## äºŒã€async å’Œ await åŠå…¶è¿”å›è¯­æ³•

`async` ä»…ç”¨äº**æ˜¾å¼æŒ‡å®šè¿”å›çš„æ˜¯ä¸€ä¸ªPromise**



## ä¸‰ã€Vue ä»£ç ç¤ºä¾‹

### (1) ä½¿ç”¨ setTimeout æ¨¡æ‹Ÿ Promise è¶…æ—¶ç­‰å¾… 
æˆ‘ä»¬å¯ä»¥ç”¨ `setTimeout` æ¥<mark style="background: transparent; color: red">æ¨¡æ‹Ÿä¸€ä¸ªéœ€è¦å»¶è¿Ÿçš„å¼‚æ­¥æ“ä½œ</mark>ã€‚
ä¾‹å¦‚ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª `delay` å‡½æ•°ï¼Œåœ¨**æŒ‡å®šçš„æ—¶é—´åè¿”å›ä¸€ä¸ªå®ŒæˆçŠ¶æ€çš„ `Promise`, ä½†æ˜¯è¿™ä¸ªä¸€èˆ¬å»¶æ—¶æ¯”è¾ƒé•¿**, å› æ­¤å¾€å¾€ä¸ä½¿ç”¨è¿™ç§æ–¹æ³•:
```js
function delay(ms) {
    return new Promise((resolve) => {
        setTimeout(resolve, ms);
    });
}
// ä½¿ç”¨ delay å‡½æ•°ç­‰å¾… 3 ç§’é’Ÿ
delay(3000).then(() => {
    console.log("3 ç§’é’Ÿåæ‰§è¡Œ");
});
```

åœ¨ä¸€äº›åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬<mark style="background: transparent; color: red">å¯èƒ½æƒ³è®¾ç½®ä¸€ä¸ªç­‰å¾…è¶…æ—¶åŠŸèƒ½</mark>ï¼Œæ¯”å¦‚åœ¨ç½‘ç»œè¯·æ±‚ä¸­ç­‰å¾…ä¸€æ®µæ—¶é—´åè‡ªåŠ¨åœæ­¢ã€‚è¿™æ—¶å¯ä»¥ç”¨ `Promise.race` æ¥**ç»“åˆä¸€ä¸ªè¶…æ—¶** `Promise` å’ŒåŸå§‹ `Promise`:   
```js
function fetchDataWithTimeout(url, timeout) {
    // 1. åŸå§‹è¯·æ±‚çš„ Promise
    const fetchPromise = fetch(url);
    // 2. è¶…æ—¶çš„ Promise
    const timeoutPromise = new Promise((_, reject) => {
        setTimeout(() => reject(new Error("è¯·æ±‚è¶…æ—¶")), timeout);
    });

    // 3. ä½¿ç”¨ Promise.race ç­‰å¾…ç¬¬ä¸€ä¸ªå®Œæˆçš„
    return Promise.race([fetchPromise, timeoutPromise]);
}

// è°ƒç”¨ç¤ºä¾‹ï¼šå¦‚æœ 2 ç§’å†…è¯·æ±‚æœªå®Œæˆï¼Œåˆ™è§¦å‘è¶…æ—¶
fetchDataWithTimeout("https://jsonplaceholder.typicode.com/posts", 2000)
    .then(response => response.json())
    .then(data => console.log(data))
    .catch(error => console.error(error.message));
```
è¯´æ˜:
1. `fetchPromise` æ˜¯å®é™…çš„ç½‘ç»œè¯·æ±‚çš„ `Promise`ã€‚
2. `timeoutPromise` æ˜¯ä¸€ä¸ªåœ¨æŒ‡å®šæ—¶é—´åè§¦å‘å¤±è´¥çš„ `Promise`ã€‚
3. `Promise.race([fetchPromise, timeoutPromise])` ç­‰å¾…å…¶ä¸­ç¬¬ä¸€ä¸ªå®Œæˆçš„ `Promise`ï¼Œè‹¥è¯·æ±‚åœ¨è¶…æ—¶å‰å®Œæˆåˆ™è¿”å›æ•°æ®ï¼Œå¦åˆ™è§¦å‘è¶…æ—¶é”™è¯¯ã€‚
ä¹Ÿå¯ä»¥å°†è¿™ç§è¶…æ—¶åŠŸèƒ½å°è£…åˆ°ä¸€ä¸ªé€šç”¨å‡½æ•°ä¸­ï¼Œä½¿å¾—å®ƒèƒ½ä¸ºä»»æ„ `Promise` æ·»åŠ è¶…æ—¶:
```js
function withTimeout(promise, ms) {
    const timeoutPromise = new Promise((_, reject) => {
        setTimeout(() => reject(new Error("æ“ä½œè¶…æ—¶")), ms);
    });
    return Promise.race([promise, timeoutPromise]);
}

// ç¤ºä¾‹ï¼šå¯¹ä»»æ„ Promise æ·»åŠ è¶…æ—¶åŠŸèƒ½
const myPromise = new Promise(resolve => {
    setTimeout(() => resolve("æ“ä½œæˆåŠŸ"), 3000);
});

withTimeout(myPromise, 2000)
    .then(result => console.log(result))
    .catch(error => console.error(error.message)); // è¾“å‡º "æ“ä½œè¶…æ—¶"

```
è¿™æ ·ï¼Œé€šè¿‡ä½¿ç”¨ `setTimeout` å’Œ `Promise.race`ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä¸ºä»»ä½•å¼‚æ­¥æ“ä½œè½»æ¾å®ç°è¶…æ—¶æ§åˆ¶ã€‚ 

### (2) ä½¿ç”¨ Promise åŒæ­¥åŠ è½½èƒŒæ™¯å›¾ç‰‡  
éœ€è¦æ³¨æ„,  å¦‚æœæ˜¯è¿”å›ä¸€ä¸ª Promise å¯¹è±¡, 
åˆ™ function å‰é¢å¯ä»¥åŠ ä¸Š async (å‚è€ƒ[[ğŸ“˜ClassNotes/âŒ¨ï¸ Web Programming/ğŸµJavaScript/3. JavaScript è¯­æ³•å…¥é—¨å’Œå¯¹è±¡#1. async å’Œ await å‡½æ•°åŸºæœ¬è¯­æ³•|async å’Œ await å‡½æ•°åŸºæœ¬è¯­æ³•]])ï¼Œ ä½†æ˜¯ä¹Ÿå¯ä»¥çœå»ã€‚ 
`async` å…³é”®å­—çš„ä¸»è¦ä½œç”¨æ˜¯è®©å‡½æ•°è‡ªåŠ¨è¿”å›ä¸€ä¸ª `Promise`, å¹¶å…è®¸ä½¿ç”¨ `await` è¯­æ³•æ¥ç®€åŒ–å¼‚æ­¥ä»£ç ã€‚

```vue
<template>
  <div v-if="imagesLoaded">
    <!-- é¡µé¢å†…å®¹ -->
    <h1>é¡µé¢å†…å®¹åŠ è½½å®Œæ¯•</h1>
  </div>
  <div v-else>
    <!-- åŠ è½½åŠ¨ç”»æˆ–è€…å ä½å†…å®¹ -->
    <h1>æ­£åœ¨åŠ è½½ä¸»é¢˜å›¾ç‰‡...</h1>
  </div>
</template>

<script lang="ts">
import { ref, onMounted } from 'vue';
// ç”¨äºå­˜å‚¨å›¾ç‰‡æ˜¯å¦åŠ è½½å®Œæˆçš„çŠ¶æ€
const imagesLoaded = ref(false);

async function loadImage(src: string): Promise<HTMLImageElement> {
    const p: Promise<HTMLImageElement> = new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => {
            resolve(img); // return the image object
        };
        img.onerror = () => {
            reject("error occured while background image loading : " + img.src);
        };
        img.src = src;
    });
    p.catch((error) => {
        console.error(error);
    }); // catch the error
    return p;
}

export default {
  setup() {
    const imageUrls = [
      '/path/to/image1.jpg', // å›¾ç‰‡ 1 è·¯å¾„
      '/path/to/image2.jpg'  // å›¾ç‰‡ 2 è·¯å¾„
    ]; 
    // é¡µé¢åŠ è½½æ—¶ï¼ŒåŠ è½½å›¾ç‰‡
    onMounted(async () => {
      try {
	      // åˆ—è¡¨çš„ map æ–¹æ³•å°†æ¯ä¸ªå…ƒç´ è°ƒç”¨ä¸€æ¬¡å‡½æ•°
        await Promise.all(imageUrls.map(loadImage)); // å¹¶è¡ŒåŠ è½½ä¸¤å¼ å›¾ç‰‡
        imagesLoaded.value = true; // ä¸¤å¼ å›¾ç‰‡åŠ è½½å®Œæˆåï¼Œæ›´æ–°çŠ¶æ€
      } catch (error) {
        console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', error);
      }
    });
    return {
      imagesLoaded
    };
  }
};
</script>

<style scoped>
/* ä½ å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ ·å¼ */
</style>
```

### (3) åœ¨å›¾ç‰‡åŠ è½½å®Œæ¯•ä¹‹åè®¾ç½®èƒŒæ™¯
ç”±äº Vue çš„ç”Ÿå‘½æœŸåœ¨ OnMounted è¿‡ç¨‹è¿›è¡ŒåŠ è½½, åˆ™ : 
- åœ¨ `mounted` æ—¶ï¼Œå¯åŠ¨å›¾ç‰‡åŠ è½½é€»è¾‘ã€‚
- ä½¿ç”¨ `Promise` æˆ– `async/await` ç¡®ä¿åŠ è½½å®Œæˆåè®¾ç½®èƒŒæ™¯ã€‚
- ä½¿ç”¨ `watch` æˆ– `computed` ç›‘å¬ `backgroundLoaded` çŠ¶æ€å˜åŒ–ï¼Œæˆ–ç›´æ¥è§¦å‘å›è°ƒé€»è¾‘ã€‚

å®é™…éœ€è¦ async ä¹‹ååœ¨ä¸»å‡½æ•°ä¸­ await ç­‰å¾…ç›´åˆ°åŠ è½½å®Œæˆ; 

### ä»£ç è§£æ

1. **`loadImage` å‡½æ•°**ï¼š
    
    - è¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªå›¾ç‰‡çš„ `src`ï¼Œè¿”å›ä¸€ä¸ª `Promise`ã€‚`Promise` ä¼šåœ¨å›¾ç‰‡åŠ è½½æˆåŠŸæ—¶ `resolve`ï¼Œåœ¨åŠ è½½å¤±è´¥æ—¶ `reject`ã€‚
    - æˆ‘ä»¬ä½¿ç”¨äº† `new Image()` æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å›¾ç‰‡å¯¹è±¡ï¼Œå¹¶ä¸º `onload` å’Œ `onerror` äº‹ä»¶ç»‘å®šå›è°ƒã€‚
2. **`Promise.all` å¹¶è¡ŒåŠ è½½**ï¼š
    
    - åœ¨ `onMounted` ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­ï¼Œä½¿ç”¨ `Promise.all(imageUrls.map(loadImage))` æ¥å¹¶è¡ŒåŠ è½½ä¸¤å¼ å›¾ç‰‡ã€‚`Promise.all` ä¼šç­‰å¾…æ‰€æœ‰çš„ `Promise` éƒ½å®Œæˆï¼ˆå³æ‰€æœ‰å›¾ç‰‡éƒ½åŠ è½½å®Œæˆï¼‰åæ‰ä¼šç»§ç»­æ‰§è¡Œã€‚
3. **`imagesLoaded` çŠ¶æ€**ï¼š
    
    - `imagesLoaded` æ˜¯ä¸€ä¸ª `ref`ï¼Œç”¨äºè·Ÿè¸ªå›¾ç‰‡æ˜¯å¦åŠ è½½å®Œæˆã€‚
    - å½“ä¸¤å¼ å›¾ç‰‡éƒ½åŠ è½½å®Œæˆæ—¶ï¼Œ`imagesLoaded.value = true`ï¼Œé¡µé¢å†…å®¹ä¼šæ˜¾ç¤ºã€‚
4. **`v-if="imagesLoaded"`**ï¼š
    
    - åœ¨æ¨¡æ¿ä¸­ï¼Œä½¿ç”¨ `v-if` æ¥æ§åˆ¶é¡µé¢å†…å®¹çš„æ¸²æŸ“ã€‚åªæœ‰å½“ä¸¤å¼ å›¾ç‰‡éƒ½åŠ è½½å®Œæˆæ—¶ï¼Œé¡µé¢å†…å®¹æ‰ä¼šæ˜¾ç¤ºï¼›å¦åˆ™ï¼Œæ˜¾ç¤ºä¸€ä¸ªåŠ è½½æç¤ºæˆ–å ä½å†…å®¹ã€‚

### æ ¸å¿ƒè¦ç‚¹

- **å¹¶è¡ŒåŠ è½½**ï¼šé€šè¿‡ `Promise.all` å¹¶è¡ŒåŠ è½½ä¸¤å¼ å›¾ç‰‡ï¼Œç¡®ä¿å®ƒä»¬éƒ½åŠ è½½å®Œæ¯•ã€‚
- **é¡µé¢ç­‰å¾…**ï¼šåœ¨å›¾ç‰‡åŠ è½½å®Œæˆä¹‹å‰ï¼Œä½¿ç”¨ `v-if` æ§åˆ¶é¡µé¢çš„æ˜¾ç¤ºï¼Œé¿å…å›¾ç‰‡åŠ è½½ä¸å®Œå…¨æ—¶é¡µé¢å†…å®¹æ¸²æŸ“ã€‚
- **é”™è¯¯å¤„ç†**ï¼šå¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œæ§åˆ¶å°ä¼šè¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œä¾¿äºè°ƒè¯•ã€‚

è¿™ç§æ–¹å¼èƒ½ä¿è¯ä¸¤å¼ å›¾ç‰‡åœ¨é¡µé¢æ­£å¼åŠ è½½å‰è¢«åŠ è½½å®Œæˆï¼Œä»è€Œé¿å…äº†å…ˆåŠ è½½ä¸€å¼ å›¾ç‰‡çš„æƒ…å†µã€‚

### 1. `Promise.race()`
`Promise.race()` è¿”å›ä¸€ä¸ª Promiseï¼Œè¯¥ Promise ä¼šåœ¨ä¼ å…¥çš„ Promise ä¸­**æœ€å¿«å®Œæˆçš„**ä¸€ä¸ª Promise å®Œæˆæ—¶ï¼Œé©¬ä¸Šè¿”å›å…¶ç»“æœæˆ–æ‹’ç»ç»“æœã€‚å³ä½¿å…¶ä»– Promise å°šæœªå®Œæˆï¼Œä¹Ÿä¼šè¿”å›ç¬¬ä¸€ä¸ªå®Œæˆçš„ Promiseã€‚

#### ç”¨æ³•

```javascript
const promise1 = new Promise((resolve) => setTimeout(resolve, 100, 'First'));
const promise2 = new Promise((resolve) => setTimeout(resolve, 500, 'Second'));

Promise.race([promise1, promise2])
  .then(result => {
    console.log(result);  // "First" (å› ä¸º promise1 æ›´æ—©å®Œæˆ)
  });
```

#### è¾“å‡º
```
First
```

### 2. `Promise.allSettled()`
`Promise.allSettled()` è¿”å›ä¸€ä¸ª Promiseï¼Œå®ƒä¼šç­‰å¾…æ‰€æœ‰ä¼ å…¥çš„ Promise éƒ½å®Œæˆï¼Œä¸ç®¡æ˜¯è¢«è§£å†³ï¼ˆfulfilledï¼‰è¿˜æ˜¯è¢«æ‹’ç»ï¼ˆrejectedï¼‰ã€‚å®ƒè¿”å›ä¸€ä¸ªåŒ…å«æ¯ä¸ª Promise çš„ç»“æœå¯¹è±¡çš„æ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸ªç»“æœå¯¹è±¡åŒ…å« `status` å’Œ `value` æˆ– `reason`ã€‚   
#### ç”¨æ³•
```javascript
const promise1 = Promise.resolve(42);
const promise2 = Promise.reject("Error");
const promise3 = new Promise((resolve, reject) => setTimeout(resolve, 100, "Success"));

Promise.allSettled([promise1, promise2, promise3])
  .then(results => {
    console.log(results);
  });
```

#### è¾“å‡º
```
[
  { status: "fulfilled", value: 42 },
  { status: "rejected", reason: "Error" },
  { status: "fulfilled", value: "Success" }
]
```

### 3. `Promise.any()`
`Promise.any()` è¿”å›ä¸€ä¸ª Promiseï¼Œå®ƒä¼šè¿”å›ç¬¬ä¸€ä¸ªæˆåŠŸï¼ˆresolvedï¼‰çš„ Promise çš„ç»“æœã€‚å¦‚æœæ‰€æœ‰ä¼ å…¥çš„ Promise éƒ½å¤±è´¥ï¼ˆrejectedï¼‰ï¼Œåˆ™è¿”å›ä¸€ä¸ªå¤±è´¥çš„ Promiseï¼Œå¹¶ä¸”æ‹’ç»ç†ç”±æ˜¯ç¬¬ä¸€ä¸ªå¤±è´¥çš„ Promiseã€‚

#### ç”¨æ³•

```javascript
const promise1 = Promise.reject("Error 1");
const promise2 = Promise.resolve("Success 2");
const promise3 = new Promise((resolve) => setTimeout(resolve, 100, "Success 3"));

Promise.any([promise1, promise2, promise3])
  .then(result => {
    console.log(result);  // "Success 2" (ç¬¬ä¸€ä¸ª resolved çš„ Promise)
  })
  .catch(error => {
    console.log(error);  // å¦‚æœæ‰€æœ‰ Promise éƒ½ rejected, ä¼šè¿›å…¥è¿™é‡Œ
  });
```

#### è¾“å‡º
```
Success 2
```

### 4. `Promise.resolve()`
`Promise.resolve()` è¿”å›ä¸€ä¸ªå·²ç»è§£æï¼ˆresolvedï¼‰çŠ¶æ€çš„ Promiseã€‚å®ƒç”¨äºå°†ä¸€ä¸ªå€¼æˆ–ä¸€ä¸ªå·²æœ‰çš„ Promise è½¬æ¢æˆä¸€ä¸ªå·²è§£æçš„ Promiseã€‚
#### ç”¨æ³•
```javascript
const promise = Promise.resolve("Success");

promise.then(result => {
  console.log(result);  // "Success"
});
```

#### è¾“å‡º
```
Success
```

### 5. `Promise.reject()`
`Promise.reject()` è¿”å›ä¸€ä¸ªå·²ç»æ‹’ç»ï¼ˆrejectedï¼‰çŠ¶æ€çš„ Promiseã€‚å®ƒç”¨äºå°†ä¸€ä¸ªæ‹’ç»çš„ç†ç”±åŒ…è£…æˆä¸€ä¸ª Promiseã€‚

#### ç”¨æ³•

```javascript
const promise = Promise.reject("Failure");

promise.catch(error => {
  console.log(error);  // "Failure"
});
```

#### è¾“å‡º
```
Failure
```

### 6. `Promise.finally()`
`Promise.finally()` åœ¨ Promise å®Œæˆï¼ˆæ— è®ºæ˜¯ resolved è¿˜æ˜¯ rejectedï¼‰æ—¶ä¼šè¢«æ‰§è¡Œï¼Œä¸ç®¡ç»“æœå¦‚ä½•ã€‚å®ƒé€šå¸¸ç”¨äºæ¸…ç†æ“ä½œï¼ˆä¾‹å¦‚å…³é—­æ–‡ä»¶ã€ç½‘ç»œè¿æ¥ç­‰ï¼‰ã€‚

#### ç”¨æ³•

```javascript
const promise = new Promise((resolve, reject) => {
  setTimeout(() => resolve("Done"), 1000);
});

promise
  .then(result => {
    console.log(result);  // "Done"
  })
  .catch(error => {
    console.log(error);
  })
  .finally(() => {
    console.log("Promise has been settled (either resolved or rejected)");
  });
```

#### è¾“å‡º
```
Done
Promise has been settled (either resolved or rejected)
```