
å¦‚æœä½ åœ¨åç«¯çš„ `Response` ä¸­è®¾ç½®äº†æºå¸¦ `token` çš„ `cookie`ï¼Œä½†å‰ç«¯æ— æ³•è·å–å®ƒï¼Œå¯èƒ½æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š

### å¯èƒ½çš„åŸå› ï¼š

1. **`httpOnly=True`**ï¼š`httpOnly` cookie ä¸èƒ½é€šè¿‡ `JavaScript`ï¼ˆ`document.cookie`ï¼‰è®¿é—®ï¼Œ åªèƒ½åœ¨ `HTTP è¯·æ±‚` æ—¶è‡ªåŠ¨å‘é€ã€‚
2. **è·¨åŸŸ (`CORS`) é™åˆ¶**ï¼šå¦‚æœå‰ç«¯å’Œåç«¯çš„åŸŸåä¸åŒï¼ˆå³ä½¿ç«¯å£ä¸åŒï¼‰ï¼Œéœ€è¦æ­£ç¡®è®¾ç½® `credentials` é€‰é¡¹ã€‚
3. **`SameSite` è§„åˆ™**ï¼šå¦‚æœ `SameSite=Strict` æˆ– `Lax`ï¼Œå¯èƒ½å½±å“è·¨ç«™è¯·æ±‚çš„ Cookie ä¼ è¾“ã€‚
4. **Secure é™åˆ¶**ï¼šå¦‚æœ `secure=True`ï¼Œé‚£ä¹ˆ Cookie åªèƒ½åœ¨ `HTTPS` è¯·æ±‚ä¸­å‘é€ã€‚(å¯ä»¥åœ¨è°ƒè¯•ç¯å¢ƒä¸­è®¾ç½® secure éƒ¨åˆ†) 


## **å¦‚ä½•æ­£ç¡®å­˜å‚¨ Cookie**

### **åç«¯ Flask è®¾ç½® Token Cookie**

ä½ å¯ä»¥ä½¿ç”¨ `response.set_cookie()` æ¥è®¾ç½® `token`ï¼Œå¹¶ç¡®ä¿æ­£ç¡®è®¾ç½® `Secure`ã€`SameSite`ã€`HttpOnly` ç­‰å±æ€§ï¼š

```python
from flask import Flask, jsonify, make_response

app = Flask(__name__)

@app.route('/login')
def login():
    token = "your_generated_token"

    response = make_response(jsonify({
        "succeed": True,
        "message": "Login successful"
    }))

    # è®¾ç½® Cookie
    response.set_cookie(
        key="token",
        value=token,
        httponly=True,  # é˜²æ­¢ JavaScript è®¿é—®
        secure=True,    # ä»…åœ¨ HTTPS ä¼ è¾“
        samesite="Lax", # å…è®¸éƒ¨åˆ†è·¨ç«™è¯·æ±‚ï¼ˆå¯é€‰å€¼ï¼š"Strict", "Lax", "None"ï¼‰
        max_age=86400   # æŒä¹… Cookieï¼ˆ1 å¤©ï¼Œå•ä½ï¼šç§’ï¼‰
    )

    return response

if __name__ == '__main__':
    app.run(ssl_context='adhoc')  # ä»…ç”¨äºæœ¬åœ° HTTPS æµ‹è¯•
```

å…³äºÂ `max_age`Â çš„è®¾ç½®ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹å‡ ç‚¹è€ƒè™‘ï¼š

- **å¿…é¡»è®¾ç½®å—ï¼Ÿ**ï¼šè™½ç„¶ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œä½†å»ºè®®è®¾ç½®Â `max_age`Â ä»¥æ§åˆ¶ cookie çš„æœ‰æ•ˆæœŸã€‚æ²¡æœ‰è®¾ç½®çš„ cookie ä¼šåœ¨æµè§ˆå™¨ä¼šè¯ç»“æŸæ—¶å¤±æ•ˆã€‚
    
- **ä¸ token ä¸€è‡´è¿˜æ˜¯æ›´é•¿ï¼Ÿ**ï¼šè¿™å–å†³äºæ‚¨çš„åº”ç”¨éœ€æ±‚ã€‚å¦‚æœ cookie ç”¨äºå­˜å‚¨ä¼šè¯ä¿¡æ¯ï¼ˆå¦‚ç™»å½•çŠ¶æ€ï¼‰ï¼Œé€šå¸¸å»ºè®®å…¶è¿‡æœŸæ—¶é—´ä¸ token çš„æœ‰æ•ˆæœŸä¸€è‡´ï¼Œæˆ–è€…ç¨é•¿ä¸€äº›ï¼Œä»¥ä¾¿ç”¨æˆ·åœ¨ token è¿‡æœŸä¹‹å‰ä»ç„¶å¯ä»¥ä¿æŒç™»å½•çŠ¶æ€ã€‚è¿™æ ·å¯ä»¥æé«˜ç”¨æˆ·ä½“éªŒï¼Œä½†ä¹Ÿè¦è€ƒè™‘å®‰å…¨æ€§ï¼Œé¿å…é•¿æ—¶é—´çš„ä¼šè¯ä¿æŒã€‚ 

âœ… **å­˜å‚¨ `token` çš„æ­£ç¡®æ–¹å¼** 
- **æ¨è**ï¼šä½¿ç”¨ `httpOnly` + `Secure` Cookie å­˜å‚¨ `token`ï¼Œé¿å… XSSã€‚
- **ä¼šè¯ Cookie**ï¼šä¸è®¾ç½® `max_age`ï¼Œæµè§ˆå™¨å…³é—­åæ¸…é™¤ã€‚
- **æŒä¹… Cookie**ï¼šè®¾ç½® `max_age`ï¼Œä¾‹å¦‚ `max_age=86400` è¡¨ç¤º 1 å¤©ã€‚ 

## **å‰ç«¯å¦‚ä½•æ­£ç¡®å­˜å‚¨ Cookie**

### **1. `fetch` è¯·æ±‚æ—¶ç¡®ä¿ Cookie è¢«å‘é€**

å‰ç«¯éœ€è¦åœ¨ `fetch` æˆ– `axios` è¯·æ±‚ä¸­å¯ç”¨ `credentials: 'include'` é€‰é¡¹ï¼š

```javascript
fetch("https://your-backend.com/login", {
    method: "GET",
    credentials: "include",  // å…è®¸è·¨åŸŸæºå¸¦ Cookie
})
.then(response => response.json())
.then(data => console.log("Response:", data))
.catch(error => console.error("Error:", error));
```

#### **`Axios` ç‰ˆæœ¬**

```javascript
import axios from 'axios';

axios.get("https://your-backend.com/login", {
    withCredentials: true  // å…è®¸å‘é€è·¨åŸŸ Cookie
})
.then(response => console.log("Response:", response.data))
.catch(error => console.error("Error:", error));
```

---

### **2. ç¡®ä¿ Cookie è¢«æµè§ˆå™¨å­˜å‚¨**

å³ä½¿ `httpOnly=True`ï¼ŒCookie ä»ç„¶ä¼šè¢«å­˜å‚¨ï¼Œä½†ä¸èƒ½é€šè¿‡ `document.cookie` è®¿é—®ã€‚ä½ å¯ä»¥åœ¨ **æµè§ˆå™¨ DevTools (F12) > åº”ç”¨ > å­˜å‚¨ > Cookie** ä¸­æŸ¥çœ‹æ˜¯å¦å­˜å‚¨äº† `token`ã€‚

å¦‚æœæ²¡æœ‰å­˜å‚¨ï¼Œæ£€æŸ¥ï¼š

- **åç«¯æ˜¯å¦è¿”å› `Set-Cookie` å¤´**
- **è¯·æ±‚æ˜¯å¦åŒ…å« `credentials: 'include'`**
- **æµè§ˆå™¨æ˜¯å¦æ‹¦æˆªäº† Cookieï¼ˆæ£€æŸ¥æ§åˆ¶å°çš„ç½‘ç»œè¯·æ±‚ï¼‰**

---

## **å­˜å‚¨åˆ° "ä¼šè¯" Cookie vs "æŒä¹…" Cookie**

åœ¨ `set_cookie()` æ—¶ï¼Œä½¿ç”¨ä¸åŒçš„å‚æ•°æ¥æ§åˆ¶ `Cookie` æ˜¯ä¼šè¯çº§åˆ«çš„è¿˜æ˜¯æŒä¹…çš„ï¼š

|Cookie ç±»å‹|å‚æ•°|è¯´æ˜|
|---|---|---|
|**ä¼šè¯ Cookie**|`max_age=None`|åªåœ¨å½“å‰ä¼šè¯ï¼ˆæµè§ˆå™¨å…³é—­åæ¸…é™¤ï¼‰|
|**æŒä¹… Cookie**|`max_age=86400`|åœ¨ `max_age` è®¾å®šçš„ç§’æ•°å†…æœ‰æ•ˆï¼ˆä¾‹å¦‚ 1 å¤©ï¼‰|

### **ç¤ºä¾‹**

#### **å­˜å‚¨åœ¨ä¼šè¯ Cookieï¼ˆå…³é—­æµè§ˆå™¨åæ¸…é™¤ï¼‰**

```python
response.set_cookie("token", token, httponly=True, secure=True, samesite="Lax")
```

- ç”±äº `max_age=None`ï¼Œæµè§ˆå™¨ä¼šåœ¨å…³é—­æ—¶åˆ é™¤è¯¥ Cookieã€‚

#### **å­˜å‚¨ä¸ºæŒä¹… Cookieï¼ˆä¾‹å¦‚ 1 å¤©ï¼‰**

```python
response.set_cookie("token", token, httponly=True, secure=True, samesite="Lax", max_age=86400)
```

- è¿™å°†ä½¿ `token` åœ¨ 1 å¤©å†…æœ‰æ•ˆï¼Œå³ä½¿æµè§ˆå™¨å…³é—­ä¹Ÿä¼šä¿ç•™ã€‚

---

## **å¦‚ä½•å‰ç«¯æ‰‹åŠ¨å­˜å‚¨ `token`**

å¦‚æœä½ éœ€è¦æ‰‹åŠ¨å­˜å‚¨ `token`ï¼ˆæ¯”å¦‚ `httpOnly=False`ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ `localStorage` æˆ– `sessionStorage`ï¼š

```javascript
fetch("https://your-backend.com/login", { credentials: "include" })
.then(response => response.json())
.then(data => {
    localStorage.setItem("token", data.token);  // å­˜å…¥ localStorageï¼ˆæŒä¹…å­˜å‚¨ï¼‰
    sessionStorage.setItem("token", data.token);  // å­˜å…¥ sessionStorageï¼ˆä¼šè¯å­˜å‚¨ï¼‰
})
.catch(error => console.error("Error:", error));
```

- `localStorage`ï¼šæ•°æ®ä¼šä¸€ç›´ä¿ç•™ï¼Œå³ä½¿å…³é—­æµè§ˆå™¨
- `sessionStorage`ï¼šæ•°æ®åœ¨ä¼šè¯æœŸé—´æœ‰æ•ˆï¼Œå…³é—­æµè§ˆå™¨ååˆ é™¤

âš  **æ³¨æ„**ï¼šå¦‚æœ `token` æ˜¯æ•æ„Ÿæ•°æ®ï¼Œå»ºè®®ä½¿ç”¨ `httpOnly` + `Secure` çš„ Cookieï¼Œè€Œä¸æ˜¯ `localStorage`ï¼Œå› ä¸º `localStorage` å¯èƒ½è¢« XSS æ”»å‡»è®¿é—®ã€‚

---

## **æ€»ç»“**

âœ… **å‰ç«¯æ— æ³•è·å– Cookie çš„åŸå› **

1. `httpOnly=True`ï¼ŒCookie æ— æ³•è¢« `document.cookie` è®¿é—®ï¼Œä½†ä»ä¼šè¢«æµè§ˆå™¨å­˜å‚¨ã€‚
2. éœ€è¦ `credentials: 'include'` å‘é€è·¨åŸŸè¯·æ±‚ï¼Œå¦åˆ™æµè§ˆå™¨ä¸ä¼šå­˜å‚¨ Cookieã€‚
3. `SameSite` è®¾ç½®å¯èƒ½é˜»æ­¢è·¨ç«™è¯·æ±‚æºå¸¦ Cookieã€‚

âœ… **å­˜å‚¨ `token` çš„æ­£ç¡®æ–¹å¼**

- **æ¨è**ï¼šä½¿ç”¨ `httpOnly` + `Secure` Cookie å­˜å‚¨ `token`ï¼Œé¿å… XSSã€‚
- **ä¼šè¯ Cookie**ï¼šä¸è®¾ç½® `max_age`ï¼Œæµè§ˆå™¨å…³é—­åæ¸…é™¤ã€‚
- **æŒä¹… Cookie**ï¼šè®¾ç½® `max_age`ï¼Œä¾‹å¦‚ `max_age=86400` è¡¨ç¤º 1 å¤©ã€‚

âœ… **å¦‚ä½•æ£€æŸ¥ Cookie**

- **æµè§ˆå™¨ DevTools (F12) > åº”ç”¨ > å­˜å‚¨ > Cookie**
- **ç½‘ç»œè¯·æ±‚ (Network Tab) æ£€æŸ¥ `Set-Cookie` å¤´**

## äºŒã€Cookie å­˜å‚¨å’Œè°ƒè¯•
åœ¨è°ƒè¯•ç¯å¢ƒä¸‹, éœ€è¦è®¾ç½® httpOnly = False å’Œ Secure=false :  
- åœ¨ **HTTP** ç¯å¢ƒä¸­è°ƒè¯•æ—¶ï¼Œåº”è¯¥å°† `Secure` è®¾ç½®ä¸º `false`ï¼Œå¦åˆ™ cookie å°†ä¸ä¼šå‘é€ã€‚
- å¦‚æœä½ ä½¿ç”¨ **HTTPS** ç¯å¢ƒï¼Œå¯ä»¥å°† `Secure` è®¾ç½®ä¸º `true`ï¼Œæ­¤æ—¶ cookie å°†ä¼šæ­£å¸¸å‘é€å’Œå­˜å‚¨ã€‚


**ç¡®è®¤æœåŠ¡å™¨è®¾ç½® Cookie æ˜¯å¦æˆåŠŸ**
- æ‰“å¼€æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·ï¼Œåˆ‡æ¢åˆ° **Network** é¢æ¿ã€‚
- é‡æ–°åŠ è½½é¡µé¢ï¼ŒæŸ¥çœ‹ç›¸å…³çš„è¯·æ±‚ï¼ˆé€šå¸¸æ˜¯ä½ å‘é€è¯·æ±‚æ—¶çš„ HTTP å“åº”ï¼‰ã€‚
- æŸ¥æ‰¾å“åº”å¤´ä¸­çš„ `Set-Cookie` å­—æ®µï¼Œç¡®è®¤æœåŠ¡å™¨æ˜¯å¦è®¾ç½®äº†è¯¥ cookieã€‚ä¾‹å¦‚ï¼š


é¦–å…ˆ,å¦‚æœåœ¨å‰ç«¯å‘èµ·è·¨åŸŸè¯·æ±‚æ—¶éœ€è¦æºå¸¦ **cookies** æˆ–è€…è®¤è¯ä¿¡æ¯ï¼Œå¿…é¡»è®¾ç½®`withCredentials: true`ï¼Œå¹¶ä¸”éœ€è¦åœ¨ **Flask** åç«¯è¿›è¡Œç›¸åº”é…ç½®ï¼Œå…è®¸è·¨åŸŸè¯·æ±‚æºå¸¦å‡­è¯ã€‚

### å‰ç«¯ï¼šè®¾ç½® `withCredentials: true`

åœ¨å‰ç«¯çš„ **AJAX** è¯·æ±‚ä¸­ï¼ˆæ¯”å¦‚ä½¿ç”¨ `fetch` æˆ– `axios`ï¼‰ï¼Œä½ éœ€è¦æ˜¾å¼è®¾ç½® `withCredentials` ä¸º `true`ï¼Œè¿™æ ·æµè§ˆå™¨æ‰ä¼šåœ¨è·¨åŸŸè¯·æ±‚æ—¶å¸¦ä¸Š cookiesã€HTTPè®¤è¯ä¿¡æ¯ç­‰ã€‚

**ç¤ºä¾‹ï¼šä½¿ç”¨ `fetch`**

```javascript
fetch('http://your-api-url', {
  method: 'GET',
  credentials: 'include', // equivalent to withCredentials: true
  headers: {
    'Content-Type': 'application/json'
  }
})
.then(response => response.json())
.then(data => console.log(data));
```

**ç¤ºä¾‹ï¼šä½¿ç”¨ `axios`**

```javascript
axios.get('http://your-api-url', {
  withCredentials: true // ä½¿å¾—è¯·æ±‚æºå¸¦ cookies
})
.then(response => console.log(response))
.catch(error => console.error(error));
```

### åç«¯ï¼šFlask é…ç½® CORS

åœ¨ **Flask** åç«¯ï¼Œä½ éœ€è¦ç¡®ä¿é…ç½®äº† **CORS**ï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰å¹¶å…è®¸è·¨åŸŸè¯·æ±‚æºå¸¦å‡­è¯ã€‚å¯ä»¥ä½¿ç”¨ `flask-cors` åº“æ¥é…ç½®ã€‚

é¦–å…ˆï¼Œå®‰è£… `flask-cors`: 

```bash
pip install flask-cors
```

ç„¶åï¼Œåœ¨ Flask ä¸­é…ç½® CORSï¼š

```python
from flask import Flask
from flask_cors import CORS

app = Flask(__name__)

# å…è®¸è·¨åŸŸè¯·æ±‚æºå¸¦å‡­è¯
CORS(app, supports_credentials=True)

@app.route('/your-api')
def your_api():
    return {'message': 'Success'}
```

### å…³é”®ç‚¹ï¼š

- **å‰ç«¯**ï¼šç¡®ä¿è®¾ç½® `credentials: 'include'` æˆ– `withCredentials: true`ï¼Œè¿™æ ·æµè§ˆå™¨æ‰èƒ½æºå¸¦ cookies å’Œå…¶ä»–å‡­è¯ã€‚
- **åç«¯**ï¼šåœ¨ Flask ä¸­é…ç½® **CORS**ï¼Œå¹¶è®¾ç½® `supports_credentials=True` æ¥å…è®¸è·¨åŸŸè¯·æ±‚æºå¸¦å‡­è¯ã€‚

### è·¨åŸŸé™åˆ¶ï¼š

- **`Access-Control-Allow-Origin`**ï¼šå¯¹äºè·¨åŸŸè¯·æ±‚ï¼Œåç«¯å¿…é¡»è¿”å› `Access-Control-Allow-Origin` å¤´éƒ¨ï¼Œä¸”å…¶å€¼ä¸èƒ½æ˜¯ `*`ï¼Œå®ƒå¿…é¡»æŒ‡å®šå…è®¸çš„å…·ä½“åŸŸåã€‚ä¾‹å¦‚ï¼š
    
    ```python
    CORS(app, origins="http://your-frontend-url", supports_credentials=True)
    ```
    

### æ€»ç»“ï¼š

- å¦‚æœä½ å¸Œæœ›åœ¨è·¨åŸŸè¯·æ±‚ä¸­æºå¸¦ cookiesï¼Œéœ€è¦åœ¨å‰ç«¯è®¾ç½® `withCredentials: true` æˆ– `credentials: 'include'`ã€‚
- åœ¨ Flask åç«¯éœ€è¦é…ç½® CORSï¼Œå…è®¸è·¨åŸŸè¯·æ±‚æºå¸¦å‡­è¯ã€‚

æœ€ç»ˆå®¹æ˜“ä» Network é¢æ¿ä¸‹å¾—åˆ° Request ä¸­çš„ cookie æºå¸¦çš„ token
![[attachments/Pasted image 20250128114655.png|800]]



1. **æµè§ˆå™¨æ˜¯å¦è‡ªåŠ¨ä¿å­˜ Cookie**
å½“ä½ é€šè¿‡ **`withCredentials: true`** æˆ– **`credentials: 'include'`** å‘é€è·¨åŸŸè¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨ä¼šæ ¹æ® **`Set-Cookie`** å“åº”å¤´è‡ªåŠ¨ä¿å­˜ç”±æœåŠ¡å™¨å‘é€çš„ cookiesï¼Œå‰ææ˜¯ç¬¦åˆä»¥ä¸‹æ¡ä»¶ï¼š

- **`Secure`**ï¼šå¦‚æœ cookie è®¾ç½®äº† `Secure`ï¼Œé‚£ä¹ˆå®ƒåªèƒ½é€šè¿‡ **HTTPS** è¯·æ±‚å‘é€ã€‚
- **`SameSite`**ï¼šå¦‚æœè®¾ç½®äº† `SameSite`ï¼Œå®ƒä¼šé™åˆ¶ cookie çš„å‘é€æ–¹å¼ã€‚`SameSite=None` éœ€è¦åŒæ—¶è®¾ç½® `Secure`ï¼Œå¦åˆ™ cookie ä¸ä¼šè¢«å‘é€ã€‚

æ‰€ä»¥ï¼Œåªè¦å“åº”å¤´ä¸­åŒ…å« `Set-Cookie`ï¼Œå¹¶ä¸”æ²¡æœ‰è¿åæµè§ˆå™¨çš„å®‰å…¨ç­–ç•¥ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ä¿å­˜ cookiesï¼Œæ— éœ€é¢å¤–æ“ä½œã€‚ 



### 1. **æµè§ˆå™¨æ˜¯å¦è‡ªåŠ¨ä¿å­˜ Cookie**
å½“ä½ é€šè¿‡ **`withCredentials: true`** æˆ– **`credentials: 'include'`** å‘é€è·¨åŸŸè¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨ä¼šæ ¹æ® **`Set-Cookie`** å“åº”å¤´è‡ªåŠ¨ä¿å­˜ç”±æœåŠ¡å™¨å‘é€çš„ cookiesï¼Œå‰ææ˜¯ç¬¦åˆä»¥ä¸‹æ¡ä»¶ï¼š
- **`Secure`**ï¼šå¦‚æœ cookie è®¾ç½®äº† `Secure`ï¼Œé‚£ä¹ˆå®ƒåªèƒ½é€šè¿‡ **HTTPS** è¯·æ±‚å‘é€ã€‚
- **`SameSite`**ï¼šå¦‚æœè®¾ç½®äº† `SameSite`ï¼Œå®ƒä¼šé™åˆ¶ cookie çš„å‘é€æ–¹å¼ã€‚`SameSite=None` éœ€è¦åŒæ—¶è®¾ç½® `Secure`ï¼Œå¦åˆ™ cookie ä¸ä¼šè¢«å‘é€ã€‚
æ‰€ä»¥ï¼Œåªè¦å“åº”å¤´ä¸­åŒ…å« `Set-Cookie`ï¼Œå¹¶ä¸”æ²¡æœ‰è¿åæµè§ˆå™¨çš„å®‰å…¨ç­–ç•¥ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ä¿å­˜ cookiesï¼Œæ— éœ€é¢å¤–æ“ä½œã€‚

### 2. **å¦‚ä½•ä¿å­˜ Cookie**
å¦‚æœä½ åœ¨å‰ç«¯è·å–åˆ° cookie å’Œ tokenï¼ˆé€šè¿‡åç«¯å‘é€çš„ `Set-Cookie`ï¼‰ï¼Œå¹¶å¸Œæœ›åœ¨æµè§ˆå™¨ä¸­ä¿å­˜å®ƒä»¬ï¼Œé€šå¸¸æµè§ˆå™¨ä¼šè‡ªåŠ¨å¤„ç†è¿™äº› cookiesã€‚ä½ æ— éœ€æ˜¾å¼ä¿å­˜å®ƒä»¬ï¼Œå®ƒä»¬ä¼šå­˜å‚¨åœ¨æµè§ˆå™¨çš„ **cookie å­˜å‚¨** ä¸­ã€‚

å¦‚æœä½ æƒ³æ‰‹åŠ¨è®¾ç½® cookieï¼Œå¯ä»¥ä½¿ç”¨ JavaScript é€šè¿‡ `document.cookie` è®¾ç½® cookieï¼Œä½†è¯·æ³¨æ„ï¼Œ**`HttpOnly`** æ ‡è®°çš„ cookies ä¸èƒ½é€šè¿‡ JavaScript è®¿é—®ã€‚

**ç¤ºä¾‹ï¼šæ‰‹åŠ¨è®¾ç½® cookieï¼ˆå¦‚æœæ²¡æœ‰ `HttpOnly`ï¼‰**

```javascript
document.cookie = "myCookie=value; path=/; max-age=3600"; // è®¾ç½®æœ‰æ•ˆæœŸ1å°æ—¶
```

ä½†æ˜¯ï¼Œ**`HttpOnly`** çš„ cookies åªèƒ½ç”±æµè§ˆå™¨è‡ªåŠ¨ç®¡ç†ï¼ŒJavaScript æ— æ³•è®¿é—®å®ƒä»¬ï¼Œä¸”å®ƒä»¬é€šå¸¸ä¼šåœ¨ç”¨æˆ·å…³é—­æµè§ˆå™¨æ—¶ä¿æŒä¼šè¯æœ‰æ•ˆï¼Œæˆ–è€…æ ¹æ® `max-age` æˆ– `expires` è®¾å®šçš„è¿‡æœŸæ—¶é—´è¿›è¡Œå­˜å‚¨ã€‚

### 3. **é€šè¿‡ `beforeRouteEnter` è¿›è¡Œ Cookie èº«ä»½éªŒè¯**

åœ¨ Vue.js ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ `beforeRouteEnter` æ¥å®ç°è·¯ç”±å®ˆå«ï¼Œå¹¶åœ¨è·¯ç”±è¿›å…¥å‰è¿›è¡Œèº«ä»½éªŒè¯ã€‚ä½ å¯ä»¥é€šè¿‡æ£€æŸ¥æµè§ˆå™¨ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªç‰¹å®šçš„ cookie æˆ– token æ¥éªŒè¯ç”¨æˆ·çš„èº«ä»½ã€‚

#### ç¤ºä¾‹ï¼šé€šè¿‡ `beforeRouteEnter` è¿›è¡Œ Cookie èº«ä»½éªŒè¯

å‡è®¾ä½ æœ‰ä¸€ä¸ªåç«¯è®¾ç½®äº† `AuthToken` çš„ `HttpOnly` cookieï¼Œä½ å¸Œæœ›åœ¨ Vue çš„è·¯ç”±å®ˆå«ä¸­æ£€æŸ¥è¿™ä¸ª cookieã€‚

1. **è·¯ç”±å®ˆå«æ£€æŸ¥ Cookie** åœ¨ `beforeRouteEnter` é’©å­ä¸­ï¼Œä½ å¯ä»¥è·å– cookie æ¥éªŒè¯ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ã€‚

```javascript
import { createRouter, createWebHistory } from 'vue-router';

const routes = [
  {
    path: '/protected',
    name: 'Protected',
    component: () => import('./views/Protected.vue'),
    beforeEnter: (to, from, next) => {
      const token = getCookie('AuthToken');  // ä» cookie ä¸­è·å– token

      if (token) {
        // å¦‚æœ token å­˜åœ¨ï¼Œç”¨æˆ·å·²ç™»å½•ï¼Œå…è®¸è®¿é—®
        next();
      } else {
        // å¦‚æœæ²¡æœ‰ tokenï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢
        next({ name: 'Login' });
      }
    }
  },
  {
    path: '/login',
    name: 'Login',
    component: () => import('./views/Login.vue')
  }
];

const router = createRouter({
  history: createWebHistory(),
  routes
});

function getCookie(name) {
  const value = `; ${document.cookie}`;
  const parts = value.split(`; ${name}=`);
  if (parts.length === 2) return parts.pop().split(';').shift();
  return null;
}

export default router;
```

#### è§£é‡Šï¼š

- `beforeEnter` æ˜¯è·¯ç”±å®ˆå«çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºåœ¨è·¯ç”±è¿›å…¥ä¹‹å‰è¿›è¡Œå¤„ç†ã€‚
- `getCookie('AuthToken')` æ˜¯è·å–æµè§ˆå™¨ä¸­ `AuthToken` cookie çš„ç®€å•å‡½æ•°ã€‚æ ¹æ®ä½ çš„å®é™…æƒ…å†µï¼Œä½ å¯ä»¥ä¿®æ”¹ cookie åç§°ã€‚
- å¦‚æœ `AuthToken` å­˜åœ¨ï¼Œè¡¨ç¤ºç”¨æˆ·å·²ç»ç™»å½•ï¼Œå¯ä»¥è®¿é—® `/protected` è·¯ç”±ã€‚
- å¦‚æœ `AuthToken` ä¸å­˜åœ¨ï¼Œç”¨æˆ·æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µã€‚

### 4. **å¦‚ä½•å¤„ç†è·¨åŸŸè¯·æ±‚çš„ Cookie**

åœ¨è·¨åŸŸè¯·æ±‚æ—¶ï¼Œéœ€è¦åœ¨å‰ç«¯è®¾ç½® `withCredentials: true` æˆ– `credentials: 'include'` æ¥ç¡®ä¿æµè§ˆå™¨èƒ½å¤Ÿè‡ªåŠ¨å‘é€å¹¶æ¥æ”¶ cookiesã€‚

**ç¤ºä¾‹ï¼šå‘é€è¯·æ±‚æ—¶å¸¦ä¸Š cookie**

```javascript
fetch('http://your-api-url', {
  method: 'GET',
  credentials: 'include', // å¿…é¡»è®¾ç½®ä¸º 'include'ï¼Œæ‰èƒ½å¸¦ä¸Š cookies
})
.then(response => response.json())
.then(data => console.log(data))
.catch(error => console.error(error));
```

### æ€»ç»“ï¼š

- **æµè§ˆå™¨è‡ªåŠ¨ä¿å­˜ cookie**ï¼šæµè§ˆå™¨ä¼šè‡ªåŠ¨ä¿å­˜æ¥è‡ªåç«¯çš„ `Set-Cookie` å“åº”å¤´ä¸­çš„ cookiesï¼ˆåŒ…æ‹¬ tokenï¼‰ï¼Œå‰ææ˜¯ç¬¦åˆè·¨åŸŸè¯·æ±‚å’Œå®‰å…¨æ€§è¦æ±‚ï¼ˆå¦‚ `Secure`, `SameSite`ï¼‰ã€‚
- **éªŒè¯èº«ä»½**ï¼šä½ å¯ä»¥åœ¨ Vue è·¯ç”±å®ˆå«ä¸­ä½¿ç”¨ `beforeRouteEnter` æ¥éªŒè¯æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„ cookie æˆ– tokenã€‚å¦‚æœæ²¡æœ‰ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢ã€‚
- **è·¨åŸŸè¯·æ±‚**ï¼šéœ€è¦åœ¨è¯·æ±‚ä¸­è®¾ç½® `credentials: 'include'` æˆ– `withCredentials: true` æ¥ç¡®ä¿è·¨åŸŸè¯·æ±‚èƒ½å¤Ÿå¸¦ä¸Š cookiesã€‚


å¯¹äºç™»å½•è¯·æ±‚ï¼Œä½¿ç”¨ **GET** æ–¹æ³•å¹¶ä¸æ˜¯ä¸€ä¸ªå®‰å…¨çš„é€‰æ‹©ï¼Œå­˜åœ¨ä¸€äº›æ½œåœ¨çš„é£é™©ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…³é”®ç‚¹è¯´æ˜ï¼š


## ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨ GET è¯·æ±‚è¿›è¡Œç™»å½•ï¼š
1. **æ•æ„Ÿä¿¡æ¯æ³„éœ²**ï¼š
   - ç”±äº GET è¯·æ±‚çš„å‚æ•°ä¼šæš´éœ²åœ¨ URL ä¸­ï¼Œç”¨æˆ·çš„å‡­æ®ï¼ˆå¦‚ç”¨æˆ·åå’Œå¯†ç ï¼‰å°†æ˜¾ç¤ºåœ¨æµè§ˆå™¨åœ°å€æ ã€å†å²è®°å½•å’ŒæœåŠ¡å™¨æ—¥å¿—ä¸­ã€‚
   - è¿™å¯èƒ½ä¼šå¯¼è‡´ä¿¡æ¯æ³„éœ²ï¼Œç‰¹åˆ«æ˜¯åœ¨å…±äº«è®¾å¤‡æˆ–å…¬å…±ç½‘ç»œä¸Šã€‚

2. **ç¼“å­˜é£é™©**ï¼š
   - GET è¯·æ±‚å¯èƒ½è¢«æµè§ˆå™¨ç¼“å­˜ã€‚å¦‚æœç”¨æˆ·å°è¯•é‡æ–°åŠ è½½é¡µé¢ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šé‡æ–°æäº¤è¯·æ±‚ï¼Œå¯¼è‡´é‡å¤ç™»å½•æˆ–ä¸å¿…è¦çš„æ°”å¯†è®¿é—®ã€‚
  
3. **ä¸ç¬¦åˆè¯­ä¹‰**ï¼š
   - HTTP æ–¹æ³•æœ‰å…¶ç‰¹å®šè¯­ä¹‰ï¼ŒGET ç”¨äºè¯·æ±‚æ•°æ®ï¼Œè€Œç™»å½•æ˜¯ä¸€é¡¹çŠ¶æ€æ”¹å˜æ“ä½œï¼Œåº”è¯¥ä½¿ç”¨ POST æ–¹æ³•ã€‚

### æ›´å®‰å…¨çš„ç™»å½•æ–¹å¼ï¼š

1. **ä½¿ç”¨ POST è¯·æ±‚**ï¼š
   - ç™»å½•è¯·æ±‚åº”è¯¥ä½¿ç”¨ POST æ–¹æ³•ï¼Œç”¨æˆ·å‡­æ®é€šè¿‡è¯·æ±‚ä½“å‘é€ï¼Œå‡å°‘æ•æ„Ÿä¿¡æ¯æš´éœ²çš„é£é™©ã€‚

2. **Token å­˜å‚¨**ï¼š
   - å¦‚æœä½¿ç”¨ cookie å­˜å‚¨ tokenï¼Œè¯·ç¡®ä¿ cookie è®¾ç½®äº† `HttpOnly` å’Œ `Secure` æ ‡å¿—ï¼Œä»¥é˜²æ­¢ JavaScript è®¿é—®å’Œï¼Œåœ¨ HTTPS ä¸‹æ‰èƒ½å‘é€ã€‚

3. **ç®¡ç† Vuex çŠ¶æ€**ï¼š
   - å¦‚æœ Vuex çŠ¶æ€ä¸¢å¤±å¯¼è‡´æ¯æ¬¡éƒ½éœ€è¦è¯·æ±‚ï¼Œå¯ä»¥è€ƒè™‘åœ¨ç™»å½•åå°† token å­˜å‚¨åœ¨ **localStorage** æˆ– **sessionStorage** ä¸­ï¼Œæˆ–åœ¨ Vuex ä¸­åˆç†ç®¡ç†çŠ¶æ€ã€‚å°½é‡å‡å°‘åœ¨æ¯æ¬¡é¡µé¢åˆ·æ–°æ—¶å¤±å»çŠ¶æ€ã€‚

4. **CSRF é˜²æŠ¤**ï¼š
   - åœ¨ä½¿ç”¨ POST æ–¹æ³•ç™»å½•æ—¶ï¼Œç¡®ä¿ä½¿ç”¨ CSRF Tokenï¼Œä»¥è¿›ä¸€æ­¥å¢å¼ºåº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚

### ç»“è®ºï¼š

ä¸ºäº†æé«˜å®‰å…¨æ€§ï¼Œ**åº”è¯¥é¿å…**ä½¿ç”¨ GET è¯·æ±‚è¿›è¡Œç™»å½•æ“ä½œï¼Œé‡‡ç”¨ POST æ–¹æ³•å¹¶ç»“åˆé€‚å½“çš„å®‰å…¨ç­–ç•¥ã€‚è¿™å°†æœ‰åŠ©äºä¿æŠ¤ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯å’Œç™»å½•çŠ¶æ€ã€‚å¦‚æœå¯¹å…·ä½“å®æ–½æˆ–å…¶ä»–æ–¹é¢è¿˜æœ‰ç–‘é—®ï¼Œæ¬¢è¿è¿›ä¸€æ­¥è¯¢é—®ï¼



## ä¸‰ã€åç«¯ç™»å‡ºè¯·æ±‚

å¯¹äºç™»å½•è¯·æ±‚ï¼Œä½¿ç”¨ **GET** æ–¹æ³•å¹¶ä¸æ˜¯ä¸€ä¸ªå®‰å…¨çš„é€‰æ‹©ï¼Œå­˜åœ¨ä¸€äº›æ½œåœ¨çš„é£é™©ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…³é”®ç‚¹è¯´æ˜ï¼š

### ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨ GET è¯·æ±‚è¿›è¡Œç™»å½•ï¼š

1. **æ•æ„Ÿä¿¡æ¯æ³„éœ²**ï¼š
   - ç”±äº GET è¯·æ±‚çš„å‚æ•°ä¼šæš´éœ²åœ¨ URL ä¸­ï¼Œç”¨æˆ·çš„å‡­æ®ï¼ˆå¦‚ç”¨æˆ·åå’Œå¯†ç ï¼‰å°†æ˜¾ç¤ºåœ¨æµè§ˆå™¨åœ°å€æ ã€å†å²è®°å½•å’ŒæœåŠ¡å™¨æ—¥å¿—ä¸­ã€‚
   - è¿™å¯èƒ½ä¼šå¯¼è‡´ä¿¡æ¯æ³„éœ²ï¼Œç‰¹åˆ«æ˜¯åœ¨å…±äº«è®¾å¤‡æˆ–å…¬å…±ç½‘ç»œä¸Šã€‚

2. **ç¼“å­˜é£é™©**ï¼š
   - GET è¯·æ±‚å¯èƒ½è¢«æµè§ˆå™¨ç¼“å­˜ã€‚å¦‚æœç”¨æˆ·å°è¯•é‡æ–°åŠ è½½é¡µé¢ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šé‡æ–°æäº¤è¯·æ±‚ï¼Œå¯¼è‡´é‡å¤ç™»å½•æˆ–ä¸å¿…è¦çš„æ°”å¯†è®¿é—®ã€‚
  
3. **ä¸ç¬¦åˆè¯­ä¹‰**ï¼š
   - HTTP æ–¹æ³•æœ‰å…¶ç‰¹å®šè¯­ä¹‰ï¼ŒGET ç”¨äºè¯·æ±‚æ•°æ®ï¼Œè€Œç™»å½•æ˜¯ä¸€é¡¹çŠ¶æ€æ”¹å˜æ“ä½œï¼Œåº”è¯¥ä½¿ç”¨ POST æ–¹æ³•ã€‚

### æ›´å®‰å…¨çš„ç™»å½•æ–¹å¼ï¼š

1. **ä½¿ç”¨ POST è¯·æ±‚**ï¼š
   - ç™»å½•è¯·æ±‚åº”è¯¥ä½¿ç”¨ POST æ–¹æ³•ï¼Œç”¨æˆ·å‡­æ®é€šè¿‡è¯·æ±‚ä½“å‘é€ï¼Œå‡å°‘æ•æ„Ÿä¿¡æ¯æš´éœ²çš„é£é™©ã€‚

2. **Token å­˜å‚¨**ï¼š
   - å¦‚æœä½¿ç”¨ cookie å­˜å‚¨ tokenï¼Œè¯·ç¡®ä¿ cookie è®¾ç½®äº† `HttpOnly` å’Œ `Secure` æ ‡å¿—ï¼Œä»¥é˜²æ­¢ JavaScript è®¿é—®å’Œï¼Œåœ¨ HTTPS ä¸‹æ‰èƒ½å‘é€ã€‚

3. **ç®¡ç† Vuex çŠ¶æ€**ï¼š
   - å¦‚æœ Vuex çŠ¶æ€ä¸¢å¤±å¯¼è‡´æ¯æ¬¡éƒ½éœ€è¦è¯·æ±‚ï¼Œå¯ä»¥è€ƒè™‘åœ¨ç™»å½•åå°† token å­˜å‚¨åœ¨ **localStorage** æˆ– **sessionStorage** ä¸­ï¼Œæˆ–åœ¨ Vuex ä¸­åˆç†ç®¡ç†çŠ¶æ€ã€‚å°½é‡å‡å°‘åœ¨æ¯æ¬¡é¡µé¢åˆ·æ–°æ—¶å¤±å»çŠ¶æ€ã€‚

4. **CSRF é˜²æŠ¤**ï¼š
   - åœ¨ä½¿ç”¨ POST æ–¹æ³•ç™»å½•æ—¶ï¼Œç¡®ä¿ä½¿ç”¨ CSRF Tokenï¼Œä»¥è¿›ä¸€æ­¥å¢å¼ºåº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚

### ç»“è®º: 
ä¸ºäº†æé«˜å®‰å…¨æ€§ï¼Œ**åº”è¯¥é¿å…**ä½¿ç”¨ GET è¯·æ±‚è¿›è¡Œç™»å½•æ“ä½œï¼Œé‡‡ç”¨ POST æ–¹æ³•å¹¶ç»“åˆé€‚å½“çš„å®‰å…¨ç­–ç•¥ã€‚è¿™å°†æœ‰åŠ©äºä¿æŠ¤ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯å’Œç™»å½•çŠ¶æ€ã€‚å¦‚æœå¯¹å…·ä½“å®æ–½æˆ–å…¶ä»–æ–¹é¢è¿˜æœ‰ç–‘é—®ï¼Œæ¬¢è¿è¿›ä¸€æ­¥è¯¢é—®ï¼


å¯¹äºåç«¯çš„ç™»å‡ºè¯·æ±‚ï¼Œé€šå¸¸å»ºè®®ä½¿ç”¨ **POST** æˆ– **DELETE** æ–¹æ³•ï¼Œè€Œä¸æ˜¯ **GET** æ–¹æ³•ã€‚åŸå› å¦‚ä¸‹: 
1. **å®‰å…¨æ€§**ï¼šç™»å‡ºæ“ä½œé€šå¸¸æ¶‰åŠä¼šè¯ç®¡ç†ï¼Œä½¿ç”¨ POST æˆ– DELETE å¯ä»¥é¿å…æµè§ˆå™¨çš„ç¼“å­˜å’Œé¢„å–æ“ä½œï¼Œä»è€Œé™ä½ CSRF æ”»å‡»çš„é£é™©ã€‚

2. **è¯­ä¹‰æ¸…æ™°**ï¼šHTTP æ–¹æ³•æœ‰å„è‡ªçš„è¯­ä¹‰ã€‚POST ç”¨äºåˆ›å»ºèµ„æºï¼Œè€Œ DELETE åˆ™ç”¨äºåˆ é™¤èµ„æºã€‚ç™»å‡ºå¯ä»¥è¢«è§†ä¸ºåˆ é™¤ä¼šè¯çš„ä¸€ä¸ªæ“ä½œã€‚

3. **æ˜“äºç®¡ç†**ï¼šä½¿ç”¨ POST æˆ– DELETE æ–¹æ³•æ›´å®¹æ˜“åœ¨åç«¯è¿›è¡Œé€»è¾‘ç®¡ç†ï¼Œèƒ½å¤Ÿæ˜ç¡®åŒºåˆ†çŠ¶æ€æ”¹å˜çš„æ“ä½œå’Œæ•°æ®è¯·æ±‚ã€‚

å½“ç„¶ï¼Œåœ¨æŸäº›ç®€å•åœºæ™¯ä¸‹ï¼Œå¦‚æœä½ åªæ˜¯åœ¨å‰ç«¯åšä¸€ä¸ªç®€å•çš„ç™»å‡ºï¼ˆå¦‚æ¸…ç†æœ¬åœ°å­˜å‚¨ï¼‰ï¼Œä½¿ç”¨ GET æ–¹æ³•ä¹Ÿå¯ä»¥ï¼Œä½†è¿™å¹¶ä¸æ˜¯æ¨èçš„æœ€ä½³å®è·µã€‚

å¦‚æœä½ æœ‰ç‰¹åˆ«çš„è€ƒè™‘æˆ–åœºæ™¯éœ€è¦äº†è§£ï¼Œå¯ä»¥å‘Šè¯‰æˆ‘ï¼Œæˆ‘å¯ä»¥æä¾›æ›´å…·ä½“çš„å»ºè®®ï¼

## POST è¯·æ±‚æºå¸¦ Cookie æ–¹æ³• 
ä½ çš„ `POST` è¯·æ±‚æ²¡æœ‰æºå¸¦ `Cookie`ï¼Œå¯èƒ½çš„åŸå› æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

### **1. `credentials` éœ€è¦æ­£ç¡®è®¾ç½®**

åœ¨ `axios` è¿™æ ·çš„ HTTP åº“é‡Œï¼Œ`withCredentials: true` éœ€è¦æ”¾åœ¨ `axios.create` æˆ– `request.post` çš„ `config` é‡Œï¼š

```javascript
try {
    const response = await request.post("/auth/token/verify", {}, { 
        withCredentials: true // ç¡®ä¿å‘é€ Cookie
    });
    return Promise.resolve(response);
} catch (error) {
    return Promise.reject(error);
}
```

> âš ï¸ **æ³¨æ„ï¼š** `withCredentials` éœ€è¦æ”¾åœ¨ `config`ï¼ˆç¬¬ä¸‰ä¸ªå‚æ•°ï¼‰é‡Œï¼Œè€Œä¸æ˜¯ `data`ï¼ˆç¬¬äºŒä¸ªå‚æ•°ï¼‰ã€‚

---

### **2. ç¡®ä¿æµè§ˆå™¨å…è®¸è·¨åŸŸ Cookie**

å¦‚æœä½ çš„è¯·æ±‚æ¶‰åŠ **è·¨åŸŸ (CORS)**ï¼Œé‚£ä¹ˆåç«¯å¿…é¡»æ­£ç¡®è®¾ç½® CORS å¤´ï¼Œå…è®¸å‰ç«¯å‘é€ `Cookie`ã€‚

#### **åç«¯ (Express ç¤ºä¾‹)**

```javascript
app.use(cors({
    origin: "https://your-frontend.com", // å…è®¸çš„å‰ç«¯åœ°å€
    credentials: true // å…è®¸å‘é€ Cookie
}));
```

> âš ï¸ å¦‚æœ `credentials: true`ï¼Œé‚£ä¹ˆ `origin: "*"` ä¸èƒ½ä½¿ç”¨ï¼Œå¿…é¡»æŒ‡å®šå…·ä½“çš„å‰ç«¯åŸŸåã€‚

---

### **3. ç¡®ä¿ Cookie è®¾ç½®äº† `SameSite=None; Secure`**

ç°ä»£æµè§ˆå™¨å¯¹è·¨ç«™è¯·æ±‚çš„ Cookie æ–½åŠ äº†æ›´ä¸¥æ ¼çš„é™åˆ¶ï¼š

- `SameSite=Lax`ï¼ˆé»˜è®¤ï¼‰ï¼šä»…å…è®¸ **GET è¯·æ±‚** è‡ªåŠ¨æºå¸¦ Cookieï¼Œä½† **POST ä¸ä¼šæºå¸¦**ã€‚
- `SameSite=None` + `Secure`ï¼šå…è®¸è·¨ç«™è¯·æ±‚æºå¸¦ Cookieï¼ˆé€‚ç”¨äº HTTPS ç«™ç‚¹ï¼‰ã€‚

#### **åç«¯ (Express è®¾ç½® Cookie)**

```javascript
res.cookie("your_cookie_name", "your_value", {
    httpOnly: true,
    secure: true, // å¿…é¡»åœ¨ HTTPS ä¸‹ä½¿ç”¨
    sameSite: "None" // å…è®¸è·¨ç«™è¯·æ±‚æºå¸¦ Cookie
});
```

> **å¦‚æœä½ çš„åç«¯æ˜¯ HTTP è€Œä¸æ˜¯ HTTPSï¼Œ`Secure: true` å¯èƒ½ä¼šå¯¼è‡´ Cookie ä¸èƒ½å‘é€ï¼**

---

### **4. ç¡®ä¿ Cookie ä½œç”¨åŸŸæ­£ç¡®**

æœ‰æ—¶å€™ Cookie åªé€‚ç”¨äºç‰¹å®š `Path` æˆ– `Domain`ï¼Œæ£€æŸ¥ï¼š

1. åœ¨ **å¼€å‘è€…å·¥å…· (`F12` â†’ `Application` â†’ `Cookies`)** é‡Œçœ‹ `Path` å’Œ `Domain` æ˜¯å¦åŒ¹é…ä½ çš„è¯·æ±‚ã€‚
2. è®©åç«¯è¿”å› `Set-Cookie` å¤´ï¼š
    
    ```
    Set-Cookie: your_cookie_name=your_value; Path=/; Domain=yourdomain.com; HttpOnly; Secure; SameSite=None
    ```
    
    - ç¡®ä¿ `Path=/` ä½œç”¨äºæ•´ä¸ªç«™ç‚¹ï¼Œè€Œä¸æ˜¯å­è·¯å¾„ã€‚
    - ç¡®ä¿ `Domain` åŒ¹é…ä½ çš„åç«¯åœ°å€ã€‚

---

### **5. ç¡®ä¿å‰ç«¯å’Œåç«¯çš„åè®®ä¸€è‡´**

å¦‚æœä½ çš„ **å‰ç«¯æ˜¯ `http://localhost:3000`ï¼Œä½†åç«¯æ˜¯ `https://api.yourdomain.com`**ï¼Œåˆ™æµè§ˆå™¨å¯èƒ½ä¼šæ‹’ç»å‘é€ Cookieã€‚

#### **è§£å†³æ–¹æ¡ˆ**

- **æœ¬åœ°å¼€å‘æ—¶**ï¼Œå¯ä»¥è®©å‰ç«¯ä¹Ÿè¿è¡Œåœ¨ HTTPSï¼Œæ¯”å¦‚ï¼š
    
    ```bash
    npm run dev -- --https
    ```
    
- **æˆ–è€…åç«¯å…è®¸ HTTP è¯·æ±‚ï¼ˆä»…é™æœ¬åœ°å¼€å‘ï¼‰**ï¼š
    
    ```javascript
    res.cookie("your_cookie_name", "your_value", {
        httpOnly: true,
        secure: false, // å…è®¸ HTTPï¼ˆä»…é™æœ¬åœ°å¼€å‘ï¼‰
        sameSite: "Lax" // å…è®¸ GET è¯·æ±‚æºå¸¦
    });
    ```
    

---

### **ç»“è®º**

ä½ çš„ `POST` è¯·æ±‚ä¸æºå¸¦ `Cookie`ï¼Œå¯èƒ½æ˜¯ä»¥ä¸‹é—®é¢˜ä¹‹ä¸€ï¼š

1. **`withCredentials: true` ä½ç½®é”™è¯¯** â†’ `axios.post(url, {}, { withCredentials: true })`
2. **åç«¯ CORS å¤´ç¼ºå¤±** â†’ `credentials: true` + `origin: "https://your-frontend.com"`
3. **Cookie `SameSite` ç­–ç•¥é˜»æ­¢äº† POST è¯·æ±‚** â†’ `SameSite=None; Secure`
4. **Cookie ä½œç”¨åŸŸ (`Domain`, `Path`) ä¸åŒ¹é…**
5. **å‰ç«¯å’Œåç«¯åè®®ä¸ä¸€è‡´ï¼ˆHTTP vs HTTPSï¼‰**

å»ºè®®ï¼š

1. **æ£€æŸ¥ Network é¢æ¿ (`F12` â†’ `Network`) æ˜¯å¦å‘é€äº† `Cookie`**
2. **åœ¨ `Application` â†’ `Cookies` é‡ŒæŸ¥çœ‹ Cookie æ˜¯å¦æ­£ç¡®å­˜å‚¨**
3. **è°ƒè¯• `Set-Cookie` å¤´ï¼Œç¡®ä¿ `Secure` å’Œ `SameSite` è®¾ç½®æ­£ç¡®**
4. **å¦‚æœæ˜¯è·¨åŸŸè¯·æ±‚ï¼Œç¡®ä¿ `Access-Control-Allow-Credentials: true`**

è¯•è¯•çœ‹è°ƒæ•´è¿™äº›è®¾ç½®ï¼Œåº”è¯¥å¯ä»¥è§£å†³ä½ çš„é—®é¢˜ï¼ ğŸš€