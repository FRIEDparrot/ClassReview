## 一、响应面法及其发展
为了发展一种通过少量运算 ， 得到在概率上能够代替真实隐式功能函数的显示函数,  基本思是通过一系列实验产生若干样本， 并使用拟合的显示函数代替隐式函数。从而保证显示函数得到的失效概率收敛于真实的隐式功能函数的失效概率。

**响应面法**是可靠性分析最早使用的代理模型方法。基本思想是**选定近似隐式功能函数的多项式**， 再通**过迭代实现响应面函数的失效概率对隐式功能函数的失效概率的高精度近似**。支持向量机参考 [[📘ClassNotes/⌨️Programming/👨‍🎓Deep Learning/Class Contents/基本课程/2.SVM支持向量机|2.SVM支持向量机]] 

> [!cite] 说明
> 响应面法着重于解决如下几方面的问题:
> 1. 响应面函数的形式选取
> 2. 实验样本点的抽取 
> 3. 响应面函数的拟合

### (1) 加权回归分析的基本原理
首先假设研究的隐式极限状态方程为$g(X) = 0$, 其中输入变量为$n$维, 即$X = (X_{1}, X_{2}, \dots X_{n})$， 此时， 为了求解该隐式极限状态方程的失效概率， 使用如下的==线性响应面函数==对应的g(x)来近似最终的极限状态函数 :
$$\boxed{\overline{g}(x) = b_{0} + \sum^{n}_{i=1} b_{i}X_{i} = 0\tag{8.1.1.1}}$$
对于线性响应面函数，其中有n+1个待定系数,即$b_0, b_1, \dots b_n$, 此时，通过抽取m个样本点$x_i$来求解对应系数,<b><mark style="background: transparent; color: blue">求解系数使用最小二乘法</mark></b>, 有**下列公式成立**:
$$\Large \boxed{b = (a^{T} a)^{-1}a^{T} Y}\tag{8.1.1.2}$$
其中有: $Y$为响应列阵, **而a为由m个实验点构成的$(m \times n+1)$响应量列阵**。
$$a = \left[\begin{matrix}
1 & x_{11} & \dots &  x_{1n} \\ 
1 & x_{21} & \dots & x_{2n}  \\ 
\vdots   \\ 
1 & x_{m1} & \dots &   x_{mn}
\end{matrix}\right]$$
由于 响应面可靠性分析方法中， 最关键目标是使用$\overline{g}(x) = 0$近似g(x) = 0, 我们在响应面中, <b><mark style="background: transparent; color: blue">使用加权回归的思想求解待定系数向量b</mark></b>, 此时, 我们取 $\overline{g}(x)$ 较小的点并赋给较大的权值$w$。此时，可以使$|g(x_{i})|$较小的点在确定$\overline{g}(X)$中获得更大的权重。
而待定系数向量 $b$ 可以使用下式求得, 其中$W$是大小为 $m \times  m$ 的 权重矩阵 : 
$$\Large\boxed{b = \frac{a^{T} W Y}{a^{T} W a}}\tag{8.1.1.3}$$
上面是 n + 1行 1 列的向量, 下面是 n + 1行, n + 1列的矩阵(实际运算时， 下面求逆乘上面)

### (2) 权重矩阵的构造方式
**拟合响应面**过程中，我们可以按照下式取每个每个试验点权重:
$$\Large\boxed{w_{i} = \frac{\min (|g(x_{i})| + \delta) }{|g(x_{i})| + \delta}  \qquad (i = 1, 2,\dots m)}\tag{8.1.2.1}$$
设有m个数据点， 则只需将权重按对角排列即可形成 $m\times m$大小的权重矩阵: 
$$W = \text{diag}(w_{i})$$
其中 $\delta$ 可以设置为一个小的数($10^{-3}$可取),目的是避免实验点权重系数出现零值。通过上式可以看出, <mark style="background: transparent; color: red">对于所有的点</mark>, 实际上是以$g(x)$绝对值加权的， 且离面最近的点权值为1. 

如果按照上述方法构造权重矩阵,   则称为**线性加权响应面法**(WRSM); 
另外也可以直接赋值相同的权， 即取全部对角元素恒定为1， 非对角元素恒定为0。此时称为传统线性响应面方法(TLRSM)

### (3) 加权线性响应面选取的基本步骤
1. n个变量,   我们首先初始化中心点$x_{i} = \mu$,  选用线性的响应面函数 $\overline{g}(x) = b_0 + \sum^{n}_{i=1} b_i X_i$,  在第一次迭代时<b>使用Buncher<mark style="background: transparent; color: red">选取另外2n个实验点</mark></b>组合成试验点矩阵如下 : 
> [!NOTE] Buncher  试验点选取方法
> 以抽样中心点为均值点, 每个点按照f更改一个对应的坐标值。设输入变量维数为n,  新选2n个试验点分别选取为
> $$(x_{i1} + \sigma ,x_{i2} ,  \dots x_{in})\qquad  (x_{i1} - \sigma ,x_{i2} ,  \dots x_{in})$$
> $$(x_{i1} ,x_{i2} + \sigma,  \dots x_{in})\qquad  (x_{i1}, x_{i2} - \sigma ,  \dots x_{in})$$
> 以此类推。其中加的sigma可以乘一个系数值f， 称为插值系数。
> 最终获得 $(x_{i1}, x_{i2}, \dots x_{i2n+1})$ 共2n +1个设计点。

2.  分别调用g(x)求解在这些设计点处的响应值。 参考[[#(2) 权重矩阵的构造方式]]构造实验点的权重矩阵$W$, 并**使用加权最小二乘回归的方法, 即参考式(8.1.1.3), 确定待定系数向量b**; 并由试验点使用，获取k次迭代的待定系数向量b,  即可构造出初始的响应面函数$\overline{g}^{(k)}(x)$; 

3. 参考[[📘ClassNotes/👨‍🔧Mechanics/🖥️Computational_Mechanics/✈️航空发动机可靠性分析/第三章 可靠性灵敏度分析的矩方法#(3) 改进 FOSM 可靠性分析方法|AFOSM方法]],  使用<mark style="background: transparent; color: red">改进的一次二阶矩法</mark>求得$\overline{g}^{(k)}$的==设计点 $x_{D}^{(k)} = (x_{D1}^{(k)}, x_{D2}^{(k)}, \dots x_{Dn}^{(k)})$ 以及对应的可靠度指标== $\beta^{(k)}$, 需要注意的是, **使用改进一次二阶矩方法时， 只需将预测的响应面函数$g'(x)$代入AFOSM中代替原响应函数即可， 不使用原先的g(x)求解偏导数**: 

4. 设**使用AFOSM求解得到的设计点**为$(x_D^{(k)}, g(x_D^{(k)}))$,  而初始样本点取均值 $(\mu_{X}, g(\mu_{X}))$; 则插值公式如下: ($g(x_D^{(k)}$也可以使用$\overline{g}(x_D^{(k)}$预测函数值来替代， 调用次数更少)。 此时， 新的中心点计算为插值:
$$\Large\boxed{x_{i}^{(k+1)} = \mu_{X_{i}} + (x_{Di}^{(k)}- \mu_{X_{i}}) \frac{g(\mu_{X})}{g(\mu_{X}) - g(x_{D}^{(k)})}}\tag{8.1.3.1}$$
获取下一次计算的 $x_{1i}$ 坐标,  然后重复第1步,  直到**两次可靠度指标的计算差值小于预先给的精度指标**, 认为结果收敛。

代码示例如下:

```matlab title:线性响应面法代码示例
%% %%%%%%%%%%%% 算例 8.1 响应面法求解可靠性分析的可靠度 %%%%%%%%%%%%%%%%%%% 
% 对于指数型功能函数为g(X) = e^(0.2 x1 + 1.4)- x2, 其中x1, x2为标准正态分布
clear, clc;
g = @(x) exp(0.2 .* x(:,1) + 1.4) - x(:,2);
mu_ = [0,0];
sigma_d = [1,1];
sigma_ = diag(sigma_d.^2);

% [Pf, Pf_mu, Pf_sigma] = MCS_solu(mu_, sigma_,g, 1e7);
% [x_i, beta_res, Pf2] = AFOSM_solu(mu_,sigma_, g);

%% %%%%%%%%%%%% 线性加权响应面方法进行的可靠性分析 %%%%%%%%%%%%%%%%%%%%%%
n = size(mu_, 2);       
f = 1;                  % 设置插值系数, 即选取点距离的sigma差倍数, 默认为1

%% %%%%%%%%%%%%%%%%%%% 利用计算权重 %%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
weight_func = @(gx) min(abs(gx) + 1e-3)./(abs(gx) + 1e-3);   % WRSM权重函数, g越接近0越大
% weight_func = @(gx) ones(length(x), 1);  % TWRSM权重函数

beta_pre = 0;              % 初始迭代beta值
x0 = mu_;  y0 = g(mu_);    % 用于插值的初始样本点
xp = zeros(2 * n + 1, n);  % 设计点组
x_i = mu_;                 % 初始时, 设计点组以mu_ 为中心点;

for epoch = 1:1000
    % 第一次迭代 (buncher设计点选择方法), 选用新的2n个设计点 
    xp(1,:) = x_i;
    for i = 1:n 
        f_delta = zeros(1,n); f_delta(i) = sigma_d(i) * f;
        xp(2 * i,:) = x_i + f_delta;
        xp(2*i+1,:) = x_i - f_delta;
    end
    m = length(xp);  % 构造以下矩阵
    Y = g(xp);  % 此处调用原始函数g求解所有点的Y (m  * 1);
    W = diag(weight_func(Y));               % (m *  m);
    A = [ones(m,1), xp];                    % (m *n+1);

    b = ((A' * W * A) \ (A' * W * Y))';  % 获取待定系数向量 (n+1 * 1)
    % 对应的响应面函数为b0 + b1 x1 + b2 x2 + ... + bn xn,
    % 只需将预测响应面函数代入AFOSM中代替原响应函数即可
    
    g_new = @(x) b(1) + b(2) * x(:,1) + b(3) * x(:,2);
    % 用 AFOSM 求解设计点的可靠度指标 beta^k 以及设计点
    [x_i, beta_res, Pf] = AFOSM_solu(mu_, sigma_, g_new); 
    
    if abs(beta_res - beta_pre) < 0.001
        break;
    else  % 进行插值,  更新设计点
        x_i = mu_ +  (x_i - x0) * y0 / (y0 - g_new(x_i));
        sprintf("epoch: %d, Pf: %f, beta : %f", epoch, Pf, beta_res)
        beta_pre = beta_res;
    end
end
```

## 二、加权非线性响应面法
### (1) 基本原理
由于加权线性响应面法不能反映非线性对于可靠性的影响，可以选用二次非线性响应面模型如下 :
$$\boxed{\Large \overline{g}(X) = b_{0} + \sum^{n}_{i=1} b_{i}X_{i} + \sum^{n}_{i=1}  c_{i}X_{i-n}^{2}}$$
其中$b_{i}, c_{i}$为待定系数。上式是一种不含交叉项的二次响应面模型，并可以合写为:
$$\left\{ b_{i}, c_{i}\right\} = (b_{0}, b_{1}, \dots b_{2n})$$


### (2) 选取响应面策略与权函数的构造
选取策略是重复利用试验点, 来通过响应面法将收敛的迭代中， 减少新增的试验点个数, 来减少计算量， 从而提升计算效率。
weight1: 功能函数分式形权设置
$$\Large \begin{cases}
g_{best} = \min_{i =1}^{m} (|g(x_{i})| + \delta)  \\
w_{i} = \frac{g_{best}}{|g(x_{i})| + \delta}
\end{cases}$$
weight2: 功能函数与密度函数的比值型权数
$$\Large\begin{cases}
h_{i} = \left|\frac{g(x_{i}) + \delta}{f_{X}(x_{i})} \right|  \\
h_{best} = \min_{i = 1}^{m} h_{i} \\
w_{i} = \frac{h_{best}}{h_{i}}
\end{cases}$$

1. 初始先以传统响应面法确定$\overline{g}^{(1)}(X)$设计点和设计点$x_D^{(1)}$ 
2. 第$k$次迭代时,  $k-1$次的设计点$(x_D^{(k-1)}, g(x_D^{(k-1)}))$与均值点$(\mu_X, g(\mu_X))$ 插值得到中心点, 然后