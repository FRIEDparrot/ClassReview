#  一、写在前面
最近终于能开更了。这篇文章的来源于我的计算流体力学作业，也算是一篇我大概鸽了四五个月一直想写的文章。也算是留到国庆更新的又一篇文章吧， 也算是对之前知识的一次复习。

这一篇文章从流体力学的问题引入开始，非常详细地讲解了计算流体力学的背景并简介了一些基本的方法，并且详细介绍了其中有限元方法和有限差分法的原理，也给出了示例，代码以及结果。就流体力学的有限元法而言，我当时也是弄了十天左右才把整个过程弄清楚的，因此在这里对其做详细原理解释和过程阐述，希望能帮更多人理解有限元法更轻松一点。而有限差分方法稍简单一些。 

这一期文章是做的很用心的一期，为了把问题讲清楚， 我是从流体力学的问题引入开始讲的(想看懂只需少量基础知识)。文章篇幅比较长，也希望读者能够有所收获。

本文用到的一些定理需要较为繁琐的推导，这些推导放在pdf中, 并上传至网盘链接: 

#  二、流体力学问题的引入
在我们的生活中，无论是飞机， 航海等方面， 流体力学的分析都占有很重要的地位。通过流体力学分析飞机舰船动力以及可靠性等方法也在工程中应用广泛。
## (1) 基本流体微元的建立的欧拉法
在流体力学中， 我们假设流体是连续介质， 在分析其运动时，仍然符合基本的牛顿第二定律。材料力学中， 我们建立如下的运动模型, 一般固体力学中，对于一个微元体受到的力包括体力和面力(也称为面力张量), 其中面力如下图所示: 
![在这里插入图片描述](https://img-blog.csdnimg.cn/c6cbefdda0864ef3bd420a0ed77951b5.png)
此时，我们一般会想到将流体分解为一个个上述的质点类型的微元体来进行研究，这种研究方法称为**拉格朗日方法**，即对于任意一个质点， $t$时刻位置为
$$r = r(a,b,c,t) = x(a,b,c,t) \vec{i} + y(a,b,c,t) \vec{j} +  z(a,b,c,t)\vec{k}$$
而速度和加速度可以表示为:
$$V = \frac{\partial r(a,b,c,t)}{\partial t}\qquad a = \frac{\partial V}{\partial t} = \frac{\partial^2 r}{\partial t^2}$$
但是我们不希望研究大量质点导致问题变得繁杂。 由于流体是连续的介质， 在任一时刻我们可以将流体中的所有量看成是$x,y,z$的函数，于是我们得到**欧拉方法**， 采用==速度矢量==作为基本变量, 是时间和空间的函数:
$$\vec{V} = \vec{V}(x,y,z,t)$$
由于速度是矢量，在空间三个方向有三个分量(标量)$u,v,w$仍然也是$x,y,z,t$的函数， 从而有: 
$$u = u(x,y,z,t),\quad v = v(x,y,z,t),\quad w=w(x,y,z,t)$$
为流体的速度表达， 而我们也是通过这个列写控制方程的。
## (2) 流体运动控制方程的建立
### (1) 质量守恒方程
我们在流体中，首先研究流体在流动中的质量守恒关系。我们在流场中取一个位置固定的$dx\times dy\times dz$的**控制体**如下图，则我们以$y$方向说明该控制体的流体进入和流出的计算方式: 
![在这里插入图片描述](https://img-blog.csdnimg.cn/97ee382ea87c4ad5a56ef9c69c112c9b.png)
在单位时间内，$y$方向流入控制体的流体体积为左侧面流入的流体体积减去右侧面流出的流体体积，因而有(y方向)总共流入控制体的液体体积$\mathcal{V}_{in}$为: 
$$\mathcal{V}_{in} = v \cdot dx dz - \left(v + \frac{\partial v}{\partial y} dy\right) dxdz = -\frac{\partial V}{\partial y}dxdydz$$
在每个方向上进行叠加，从而总的空间内，容易推导出单位时间流入控制体的总液体体积为:
$$-\left(\frac{\partial u}{\partial x} + \frac{\partial v}{\partial y} + \frac{\partial w}{\partial z}\right) dxdydz$$
从而**单位时间流入控制体的流体总质量**为
$$m_{in} = -\rho \left(\frac{\partial u}{\partial x} + \frac{\partial v}{\partial y} + \frac{\partial w}{\partial z}\right) dxdydz$$
对于控制体，由于质量不会凭空产生或消失，**单位时间内, 流入控制体的液体质量等于控制体的质量增加量**，可以计算为:
$$\Delta m= \frac{\rho_{2} dxdydz - \rho_{1} dxdydz}{dt}= \frac{\partial \rho}{\partial t} dxdydz = m_{in}$$
两式联立得到流体力学的连续性方程
$$\boxed {\frac{\partial \rho}{\partial t}+ \nabla \cdot (\rho V) = 0}$$
### (2) 动量方程(N-S方程)
由于定体积的控制体不易列写动量方程， 我们**改用定质量(可变形)的控制体**，其牛顿第二定律为:
$$ F = \frac{d(mv)}{dt} $$
控制体受到本身的体力，周围流体的压强(正应力)和粘性切应力的共同作用。我们简化分析问题，**忽略粘性力**，从而有:
![[Excalidraw/计算流体力学 有限差分法和有限元法 2023-10-05 09.48.48|650]]
同时， 假设流体微元单位体受到的体力为$f$, 则单位流体受到$x$方向的力计算为: 
$$\rho f_{x} dxdydz + p_{x} dydz - \left(p_{x} + \frac{\partial p_{x}}{\partial x}dx\right)dydz$$
其中压强在任何方向上的分量相等(此处不证明), 即有$p_x = p_y = p_z = p$, 化简得到:
$$F = \left[\rho f_{x} - \frac{\partial p}{\partial x}\right] dxdydz$$
而设$t$时刻微元体位于$(x,y,z)$, 其速度为$V(x,y,z,t)$, 则$t + dt$时刻位于$(x + dx, y+ dy, z +dz)$, 其速度为$V(x + dx, y+ dy, z +dz, t + dt)$, 此时动量变化为:
$$\frac{d(mv)}{dt}= \frac{d}{dt}m \cdot [V(x + dx, y + dy, z + dz, t + dt) - V(x,y,z,t)]$$
代入$m  = \rho dxdydz$, 有
$$\frac{d(mv)}{dt} =dxdydz \cdot\left( \frac{\partial (\rho V)}{\partial x} \frac{dx}{dt} +\frac{\partial (\rho V)}{\partial y}\frac{dy}{dt} + \frac{\partial (\rho V)}{\partial z}\frac{dz}{dt} + \frac{\partial V}{\partial t}\right) = \left(u \frac{\partial (\rho V)}{\partial x} + v \frac{\partial (\rho V)}{\partial y} + w \frac{\partial (\rho V)}{\partial z}+ \frac{\partial V}{\partial t}\right) dxdydz$$
投影到$x$方向上, 则有**无粘流动的动量方程**(三个方向):
$$ \frac{\partial (\rho u)}{\partial t} + \nabla\cdot (\rho u V)= - \frac{\partial p}{\partial x}+ \rho f_{x}$$
$$ \frac{\partial (\rho v)}{\partial t} +\nabla\cdot (\rho v V) = - \frac{\partial p}{\partial y}+ \rho f_{y}$$
$$ \frac{\partial (\rho w)}{\partial t} + \nabla \cdot (\rho w V)= - \frac{\partial p}{\partial z}+ \rho f_{z}$$
上式即为$N-S$方程， 这也是流体力学中最基本的方程之一。
另外我们将
$$\frac{D T}{Dt} \equiv  \frac{\partial T}{\partial t} + (\nabla \cdot \vec{V}) T$$
称为$A$的**物质导数**, 则以上三式可以合写为如下方程
$$\boxed{\frac{D(\rho V)}{Dt} =  \frac{\partial (\rho V)}{\partial t} + (\nabla \cdot  V)\rho V = - \nabla \cdot p + \rho f}$$
### (3) 能量方程
流体的能量方程推导过程在pdf中给出， 我们仅给出能量方程最终的结果(此处忽略粘性力的作用):
$$\boxed {\frac{D\left[\rho \left(e + \frac{V^{2}}{2}\right) \right]}{Dt} = \rho \dot{q} - \nabla \cdot  (p \boldsymbol{V}) + \rho (\boldsymbol{f} \cdot \boldsymbol{V})}$$
质量守恒方程，动量方程和能量方程是流体力学的三大控制方程。在整个流体力学中有基础的地位。
上述的流体力学的偏微分方程是整个流体域的控制方程，解决起来是十分复杂的。实际情况的复杂流体计算必须借助计算机完成。从而产生了计算流体力学这一研究方法。

#  三、计算流体力学的基本方法
在计算流体力学的研究中， 主要的方法有三种，包括理论，实验研究和数值计算三种方法。
而我们可以通过数值方法进行求解, 其中，计算流体力学基本的方法有**有限差分法(FDM)，有限体积法(FVM)和有限元法(FEM)**。

**有限差分法**的==主要思想是在离散化区域之后，使用差分方程代替微分方程==, 而**有限体积法**是先将整个区域离散成一个个元素, 再将上述的控制方程离散成为**元素的平衡方程**，然后再使用插值曲线来逼近每个元素中的变量变化，从而得到整体的流动方程。**有限元法**的基本思想是建立插值基函数$\Phi$，将==区域离散化之后， 使用插值基函数和邻近点的值表示单元内的量， 从而形成一个整体的流动函数==。

