## 1. 新建板框
可以通过放置 -> 板框, 也可以通过界面上方的部分进行快捷放置。 

也可以在上面加上一定的圆角, 即直接使用圆角设置属性
![[attachments/Pasted image 20240528111206.png]]

对于PCB板的布局的核心思想, 主要是模块化布局, 即包括复位, 唤醒等等模块
原则上, 在原理图中距离近的部分, PCB上也需要尽可能接近的布局。 

Q 可以切换单位设置操作, 编辑完毕之后为了不拖动往往需要锁定对象, 只需修改属性即可

### 2. 交互式预布局和精细布局
首先， 可以通过设计 -> 布局传递的方法，将初始元件的布局传递到PCB中, 方便元件聚集来进行布局。
![[attachments/Pasted image 20240528173815.png]]


首先, <mark style="background: transparent; color: red">将原理图中的模块部分先选中</mark>，**然后切换到PCB视角, 则PCB对应的部分也会选中**。此时,可以将对应的部分拖拽出来, 进行单独编辑布局 
![[attachments/Pasted image 20240528112555.png]]
对于把电容等放在板子背后的方法，只需属性中设置即可。

![[attachments/Pasted image 20240528114843.png|400]]
需要注意的是, 网格是显示网格的大小, 栅格表示移动的步长
通过选中焊盘和 ctrl+R 可以进行隐藏和显示飞线(也可以选中整个器件并进行隐藏和显示)
按下shift + H可以高亮网格, 方便布线的进行

隐藏飞线时, 只有移动器件，飞线才会显示。 
在上方可以设置不同层之间显示的亮度设置: 
![[attachments/Pasted image 20240528132202.png]]


## 丝印的添加方法
通过添加丝印, 让总PCB板上的引脚和分区能够清晰明了,  其方法是直接切换到顶层丝印层或者底层丝印层并且进行添加文字。



最为常用的线条快捷键如下: 
![[attachments/Pasted image 20240528145605.png]]


### 设计规则的设置和检查
主要是对照原理图顺序进行布局, 根据原理图顺序布局。我们可以使用新窗口打开原理图并且实现多图工作。

有很多布线的默认快捷键, 均可以在快捷键中找到, 例如使用 alt + d 为差分对布线等。差分对布线常用于USB, HDMI, LVDS,DDR,以太网等等。
![[attachments/Pasted image 20240528152816.png]]

元器件的对齐方法如下:选中多个器件, 右键选择对齐 > 上下居中对齐和左右居中对齐;
![[attachments/Pasted image 20240528154357.png|800]]
也可以在上方选择对齐方式
![[attachments/Pasted image 20240528154754.png]]
另外为了美观还设置相应的分布， 如水平等距分布等等。

如果是对VDDA进行滤波, 往往也使用LC滤波方式, 即先经过一个3.3uH左右的电感。
> [!NOTE] 笔记
> 
在==**并联滤波电容的放置中, 一般遵循先大后小的规则， 即先流经大电容, 再流经小电容的滤波顺序**==, 例如**从3V3引脚引到VDDA引脚, 则需要先经过大电容， 再经过小电容**。
> 对于晶振而言， **1M$\Omega$的电阻要放在靠近芯片的位置, 而电容要放在电阻和晶振的中间**
> 一般而言引脚处的滤波电容应当靠近芯片本身

选项过滤器可以在过滤中找到。 



### 4. 差分对管理器的使用
方法是设计 -> 差分对管理器 可以添加差分对, 并使用差分对布线 alt + d

布线 > 布线拐角 > 设置布线的拐角方式
![[attachments/Pasted image 20240528181005.png]]

### 5. 网络管理器和设计规则的设置
规则在对应的 设计 -> 设计规则 中进行找到, 具体如图所示:
![[attachments/Pasted image 20240528203420.png]]

其中1oz和2oz是盎司厚度单位, 即走线厚度, 包括1oz和2oz, 但是一般情况下都使用1oz的铜厚来制作。
需要说明的是, 一般的间距设置为8mil以上时, 一般的板厂均可生产出来。 

对于导线的宽度, 为了能够让电源线通过更大的电流, 我们可以选择 物理 > 导线 > 点击加号, 添加一个pwr线宽
![[attachments/Pasted image 20240528211915.png]]
为了确定合适的线宽, 我们采用 https://www.eda365.com/article-12-1.html 的PCB走线载流计算器。

一般的信号线, 6mil就够了(仅有几毫安), 而我们电源部分可以选择 25mil的宽度来保证0.5A的电流能够通过, 即设置pwr默认线宽为25mil. 
此时, 为了将其中的部分应用到PCB图中，需要**切换到网络规则界面**, 将对应的网络使用相应的导线。 即5V的部分使用pwr组导线 
![[attachments/Pasted image 20240528224819.png]]

也可以通过组别的方式进行添加类, 通过<mark style="background: transparent; color: red">设计 > 网络类管理器新建网络类</mark>, 具体如图所示:
![[attachments/Pasted image 20240528225606.png|800]]

如果是USB等差分线速度过高时, 必须考虑相应的组抗, 一般考虑90$\Omega$的阻抗。必须考虑线距大小， 而增加线宽也可以减小阻抗。对于高速PCB, 阻抗大小可能影响数据的传输。

<b><mark style="background: transparent; color: blue">铜皮过流能力必须和过孔过流能力匹配</mark></b>: 在过孔进行换层时, 必须使用过孔阻抗计算器进行计算, 一般而言, 内径为12mil, 外径24mil的承受能力是1.8A的电流, 如果有2A电流流过, 则必须两个过孔才能进行过流。

## PCB布线
### 1. 基本布线规则
布局原则是模块化布局， 布线的规则是先从线比较多的部分进行布局, 先布线 MCU 的部分

为了能够让总体的布线和设定的线宽相匹配, 选择起始布线宽度 -> 跟随规则 的方法。
![[attachments/Pasted image 20240529093606.png]]
尽可能使用45$C\degree$的走线, 在<mark style="background: transparent; color: red">走线过程中尽可能不出现锐角</mark>，由于锐角的布线容易被侵蚀, 因此基本上都使用钝角。<mark style="background: transparent; color: red">一般走线不允许出现直角和锐角</mark>(锐角严禁出现, 直角尽可能避免)。

导线走主控芯片底层的原则: 
一般在芯片底层走线是备选方案, 尽量走顶层的走线。
对于看整体布线有没有布完, 方法是从左侧的工程设计 > 飞线, 然后将GND隐藏, 并将其他所有的线都布好。
![[attachments/Pasted image 20240529161245.png]]

对于差分线的布线方法， 一般需要进行等长调节, 具体在布线中。包括单根先的蛇形走线(等长调节)和双蛇形走线(差分对等长调节)

有时为了更加精细的布线，可以使用alt+S进行关闭吸附, 可以更加精细地布线。
空格可以切换布线的角度(是先直线后斜线还是先斜线后直线)

### 2. 晶振的包地和挖空操作
晶振的包地: 一般对于8MHz晶振, 需要进行包地, 即将电容OSC_OUT和OSC_IN旁边的GND部分引出，然后在电阻附近也加上包地，使其整个被地线环绕一周。
![[attachments/Pasted image 20240529102311.png]]

晶振的包地是为了防止其他信号对脉冲的影响, 需要使用包地方法隔绝外界与晶振, 同时隔绝其对外界的干扰。
![[attachments/Pasted image 20240529103909.png]]
此外, 需要在晶振的包地处适当打较多的过孔。对于32.768kHz的晶振, 也需要进行包地操作。方法完全类似。

需要说明的是, 在芯片附近的电源线部分, 由于不能超过焊盘宽度(12mil), 则最大走线宽度只能设置为12mil, 如果最大走线宽度超过焊盘, 则往往会带来焊接和后续调试的问题。

一般, 3V3选择16mil左右为宜, 芯片附近的3V3, GND采用12mil, 而5V部分一般会考虑16-20mil为走线宽度。

在实际操作中，单独隐藏某个网络时, 可以选中其可见状态。即将GND可以直接先隐藏, 如下图:
![[attachments/Pasted image 20240529144238.png]]
可以使用T,B 快捷键进行换层， 在切换层过程中, 会有自动的打孔操作。同时也有打孔自动切换层的操作。

对于不得不三点进行铺铜的部分, 一般我们要进行圆弧过渡设置, 如下图(需要移除"移除原有导线"), 或者添加泪滴。
![[attachments/Pasted image 20240530000315.png]]

### 3. 铺铜操作的使用
我们实际上, 往往在底层实际上会进行整体覆铜GND网络， 覆盖上一层较大的地层的大的网络铜皮。

基本的操作是 放置 > 铺铜区域 > 多边形, 即alt + e, 可以进行快捷铺铜。
![[attachments/Pasted image 20240529201304.png|550]]

一般而言, 铺铜区域需要选择网格， 而单网络一般是默认的, 直接铺铜即可。铺完点击重建(shift+B),(也可以通过右键进行), 即可获得。

对于铺铜规则, 我们可以在铺铜选项中设置, 一般地， 可以设置不管是几层焊盘都是直连的连接方式。
如果是发散连接, 往往会少铺铜。
![[attachments/Pasted image 20240529202258.png]]
一般均选择直连即可。 
![[attachments/Pasted image 20240529202441.png]]
需要说明的是<mark style="background: transparent; color: red">十字连接和全连接的区别</mark>。对于全连接, 是整个系统全部铺铜的操作, 而十字连接是焊盘和丝印外部的形成十字连接结构。即会将铺铜部分四边连接到一起。 其宽度可以通过

其中 -> 如果是手工焊接， 一般选用十字连接结构， 而机器焊接一般选用直连, 这是因为焊盘和铜皮连接部分比较多时, 散热容易快， 导致锡快速凝固，不利于手工焊接的进行。 因此一遍选择发散(十字连接)的方法进行铺铜。 如果大面积铺铜，建议使用十字连接。 
![[attachments/Pasted image 20240529220751.png|350]]
shift + m 可以切换图层的显示和隐藏。

对于填充的增加, 可以通过放置 > 填充来进行。但是，对于铺铜，有自动避让的功能, 而填充没有相应的功能。
同时，考虑回流问题，可能在GND回流上可能会多加上几个过孔来进行回流设定。 

### 4. 底层GND铺铜的大面积铺设
对于GND网络的大面积铺铜, 首先要设置晶振的静止铺铜, 即将晶振的内部和传输线和地平面隔离开。这样晶振线上的干扰不会和地面上的互传。 

首先, 点击<mark style="background: transparent; color: red">放置 > 禁止区域 > 多边形</mark>, 将区域设置为仅禁止铺铜(取消元件选项) 

![[attachments/Pasted image 20240530001323.png|550]]
直接在板框外进行放置 > 铺铜区域 > 矩形进行大面积铺铜，全填充效果如图所示:
![[attachments/Pasted image 20240530003217.png]]
可以通过规则设置 -> 网络间距设置对应的间距为相应的大小。

保留孤岛选项是有一块闭合的导线面, 并和外面连接起来, 一般都使用否。网格状铺铜在笔记本主板上多, 韧性好。而网格韧性好很多()。同时, 一般都不保留铺铜中的孤岛。

在顶层中也需要进行铺铜(也铺GND处理)。 shift + B 重建铺铜。
对于自己画的封装想显示3D模型时, 则可以通过 工具 > 3D模型管理器, 可以自动搜索并且管理。


## PCB的DRC检测
设计 > 检查DRC
布线也基本完成

DRC检测完毕之后, 说明连线和基本功能都没有问题了。 <mark style="background: transparent; color: red">注意记得增加上泪滴</mark>使得整体的部分能够平滑过渡(做完之后记得再添加泪滴)

最后在空余的底层多打孔组, 将顶层和底层的铜皮连接起来即可。
![[attachments/Pasted image 20240530100146.png]]

### 丝印调整和优化
对于元件的位号的查找, 可以在查找中选中元件属性，然后使用位号进行。
![[attachments/Pasted image 20240530103925.png]]
然后通过布局> 
![[attachments/Pasted image 20240530104306.png]]

# STM32板问题
疑问: 
1. JTAG中的弱上拉会对STLink的电路有影响吗
2. 对于USB的电流5V部分, 使用相应的保险丝(0.05A工作电流)是否够一般的电流通过
3. 检查USB附近走线, 由于USB有两个过孔
4. 对于 JTCK, JTDO等等导线需不需要考虑高频来增加其宽度
5. **8MHz和32.768kHz两个晶振的导线在不同层交叉**了, 会不会影响很大
6. 1.5K$\Omega$ 的USB是高速传输, 当1.5k $\Omega$ 在D+ 时是全速设备(高速设备),  长度超过1800mil, 是否考虑低速设备, 以及布线是否能够在芯片下方保证不受到干扰? 

## 图标和导入
先切换到底层丝印层, 具体方法是导入 > 图片 > 然后将图片直接导入, 即可获得对应图片。

![[attachments/Pasted image 20240530115138.png|350]]

### 免费打样
首先需要先领取免费打样券, 在嘉立创中选择优惠券中心 > 免费卷领取

![[attachments/Pasted image 20240530120137.png]]
在PCB + SMT 喷锡免费劵领劵专区领取2张免费打样劵
![[attachments/Pasted image 20240530120357.png]]
选择下单 > PCB下单, 然后会自动生成Gerber, 坐标文件和BOM部分,
选择对应的优惠券。
![[attachments/Pasted image 20240530121428.png|800]]
FR-4是中间的绝缘材料, 板子尺寸 

过孔散热时, 可以选择不盖绿油。

