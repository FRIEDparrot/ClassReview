æ•°ç ç®¡çš„åŸç†æ˜¯è¾“å‡ºæ‰«æ, é€šè¿‡æ‰«æIOå£çš„æ•°æ®, å®ç°æ§åˆ¶å¤šä½æ•°çš„æ‰«æè¿‡ç¨‹ã€‚

è€ŒçŸ©é˜µé”®ç›˜æ˜¯ä½¿ç”¨è¾“å…¥æ‰«æ, é€šè¿‡æ—¶åºæ‰«ææ¯ä¸€è¡Œåˆ—å®ç°æ‰€æœ‰æŒ‰é”®çš„åŒæ—¶æ£€æµ‹ï¼ŒåŒæ—¶å¯ä»¥èŠ‚çœIOå£çš„æ•°é‡ã€‚

ä¾‹å¦‚1920x1080åƒç´ çš„æ˜¾ç¤ºå±å¹•çš„è§†é¢‘æ‰«æ, å®é™…ä¸Šéœ€è¦æ˜¾å¡çš„1920+1080çš„IOå£è¿›è¡ŒçŸ©é˜µæ‰«æå®ç°ç«¯å£çš„è¾“å…¥ã€‚

çŸ©é˜µé”®ç›˜çš„æ‰«ææ–¹æ³•æœ‰è¡Œåˆ—æ‰«ææ–¹æ³•å’Œçº¿ç¿»è½¬æ³•æ‰«ææ³•ã€‚
![[Excalidraw/çŸ©é˜µé”®ç›˜çš„ä»£ç  2023-12-05 21.35.46|800]]
`````ad-caution 
title: æ³¨æ„
collapse: open
å¯¹äº51å•ç‰‡æœºè€Œè¨€ï¼Œ ä¸Šç”µä¹‹åIOç«¯å£çš„ç”µå¹³é»˜è®¤ä¸ºé«˜ç”µå¹³
`````

<b><mark style="background: transparent; color: blue">çŸ©é˜µæŒ‰é”®çš„æ£€æµ‹æ–¹æ³•</mark></b>: ä¸¤ä¸ªç®¡è„šéƒ½æœ‰IOç›¸è¿, æ¯ä¸€æ¬¡

## è¡Œåˆ—å¼æ‰«ææ–¹æ³•
è¡Œåˆ—å¼æ‰«æçš„æ–¹æ³•æ˜¯æ¯ä¸€æ¬¡ä½¿ç”¨ä¸€åˆ—è¾“å‡ºä½ç”µå¹³(ä¾‹å¦‚), å…¶ä½™çš„ä¸ºé«˜ç”µå¹³, æ£€æµ‹å¦å¤–å››ä¸ª


é«˜ç”µå¹³01æ¥åœ¨ä¸€èµ·æ—¶, è™½ç„¶ç›¸å½“äºä¸€ç§çŸ­è·¯, 
éœ€è¦è¯´æ˜å•ç‰‡æœºIOå£å·¥ä½œæ¨¡å¼<mark style="background: transparent; color: red">æ˜¯å¼±ä¸Šæ‹‰ï¼Œ å¼ºä¸‹æ‹‰</mark>çš„åŸç†, æ¥åœ°çš„è¾“å‡º0èƒ½åŠ›è¾ƒå¼º

## çº¿ç¿»è½¬æ³•æ£€æµ‹
é¦–å…ˆè®¾ç½®å››è¡Œéƒ½ä¸ºä½ç”µå¹³ã€‚**èƒ½å¤Ÿåˆ¤æ–­å“ªä¸€åˆ—æœ‰æŒ‰ä¸‹**ã€‚
è€Œè®¾ç½®å››åˆ—ä¸ºä½ç”µå¹³,  **åˆ¤æ–­å“ªä¸€è¡Œæœ‰æŒ‰ä¸‹**ã€‚ä»è€Œåˆ¤æ–­æŒ‰ä¸‹çš„è¡Œä¸åˆ—çš„æ§åˆ¶ã€‚


å®é™…ä¸Šå•ç‰‡æœºä¸­ä½¿ç”¨äº†æ–½å¯†ç‰¹è§¦å‘å™¨è¿›è¡Œè¯»å…¥, å½“æœ‰GND 
è¿˜æœ‰æ¨æ™šè¾“å‡ºçš„æ–¹æ³•ï¼Œ ä»¥åŠé«˜é˜»è¾“å…¥ï¼ˆæ²¡æœ‰ä¸Šæ‹‰ä¹Ÿæ²¡æœ‰ä¸‹æ‹‰ï¼‰ï¼Œ å¼€æ¼è¾“å‡ºç­‰ç­‰   
å•ç‰‡æœºçš„è¾“å…¥å’Œè¾“å‡ºæ–¹å¼å¯ä»¥å‚è€ƒå•ç‰‡æœºçš„æ‰‹å†Œã€‚(IOå‡†åŒå‘å£è¾“å‡ºé…ç½®)


# å®é™…æ£€æµ‹çš„ä»£ç 
![[attachments/Pasted image 20231208100309.png|300]]
å¯¹äºçŸ©é˜µæŒ‰é”®, å…¶æ£€æµ‹ç«¯å£ä¸ºP10- P17 

```c

```



çº¿ç¿»è½¬æ³•æ£€æµ‹åŸç†: é¦–å…ˆè®¾ç½®è¡Œä¸ºé«˜ç”µå¹³, åˆ—ä¸ºä½ç”µå¹³, å³11110000, 0xF0, ç„¶åè®¾ç½®è¡Œä¸ºä½ç”µå¹³,åˆ—ä¸ºé«˜ç”µå¹³ã€‚
```c
P0 = 0x f0;
// æœ‰æŒ‰é”®æŒ‰ä¸‹æ—¶, P0çš„ç”µå¹³ä¸ç­‰äº 0xf0, ä»è€Œä½¿ç”¨ & è¿ç®—ç¬¦å¾—åˆ°æŒ‰ä¸‹çš„æŒ‰é”®ã€‚
```

### (1) è¡Œåˆ—å¼æ³•

`````ad-note
title:  è¡Œåˆ—å¼æ³•æŒ‰é”®æ£€æµ‹
collapse: close
å¸¦æœ‰æ¶ˆæŠ–çš„å®Œæ•´æŒ‰é”®æ£€æµ‹å‡½æ•°å¦‚ä¸‹ : 

```c
#include "public.h"
/* This program is for use the programming for a */

u8 gsm_code[17] = {0x3f,  0x06, 0x5b, 0x4f , 0x66,  0x6d, 0x7d, 0x07, 0x7f, 0x6f, 
				   0x77, 0x7c,  0x39, 0x5e, 0x79, 0x71};

// scan the port using the determinent method, only use this for example for first 8 keys.
void ShowNum(u8 num){
    if (num < 17) P0 = gsm_code[num];
}

// also we can write the function together and judge only four keys at one judgement. 
u8 matrix_rank_scan(){
    // scan each line, 
    u8 key_pressed = 0;
    u8 KEY = KEY_MATRIX_PORT;  // use u8 for the whole port 
    switch(KEY){ // only return the key it pressed
        case 0x77: key_pressed = 1; break; // P1_7, P1_3, which is 0111, 0111
        case 0x7b: key_pressed = 2; break; // 0111 1011
        case 0x7d: key_pressed = 3; break; // 0111 1101
        case 0x7e: key_pressed = 4; break; // 
        case 0xb7: key_pressed = 5; break; 
        case 0xbb: key_pressed = 6; break;
        case 0xbd: key_pressed = 7; break; 
        case 0xbe: key_pressed = 8; break; 
        default: break; // key_pressed = 0
    }
    return key_pressed;
}

void scan_eachline(void){
    P1 = 0x7f; // scan first column (don't use macro here) 
    if (KEY_MATRIX_PORT != 0x7f){
        Delay(10);
        while (P1 != 0x7f){
            u8 key = matrix_rank_scan();
            ShowNum(key);
        } 
    }

    P1 = 0xbf;
    if (KEY_MATRIX_PORT != 0xbf){
        Delay(10);
        while (KEY_MATRIX_PORT!=0xbf){
            u8 key = matrix_rank_scan();
            ShowNum(key);
        }
    }

    P1 = 0xdf;
    if (P1 != 0xdf){
        Delay(10);
        while (KEY_MATRIX_PORT!= 0xdf){
            u8 key = matrix_rank_scan();
            ShowNum(key);
        }
    }

    P1 = 0xef; // 1110(from P13 to P10)  1111(P17 to P14), means scan 4th column
    if (P1 != 0xef){
        Delay(10);
        while (KEY_MATRIX_PORT!= 0xde){
            u8 key = matrix_rank_scan();
            ShowNum(key);
        }
    }
    Delay(1);
    ShowNum(0);
}


void main(){
    while (1){
        scan_eachline();
    }
}

```

`````

å¯ä»¥çœ‹å‡º, è¡Œåˆ—å¼æ³•æ£€æµ‹åˆ¤æ–­çš„æ‰§è¡Œå»¶æ—¶æ˜¯æ¯”è¾ƒé«˜çš„, å› è€Œä¹Ÿå¯ä»¥ä½¿ç”¨çº¿ç¿»è½¬æ³•çš„æ–¹æ³•å¾—åˆ°æŒ‰é”®çš„å€¼ã€‚

### (2) çº¿ç¿»è½¬æ³•
çº¿ç¿»è½¬çš„åŸç†æ˜¯**å…ˆå°†è¡Œå…¨éƒ¨è®¾ç½®ä¸ºä½ç”µå¹³ï¼Œ è€Œåˆ—å…¨éƒ¨è®¾ç½®ä¸ºé«˜ç”µå¹³è·å¾—ä¸€æ¬¡ç»“æœ**ï¼Œ å†**å°†åˆ—è®¾ç½®ä¸ºä½ç”µå¹³ï¼Œè¡Œè®¾ç½®ä¸ºé«˜ç”µå¹³è·å¾—ä¸€ä¸ªç»“æœ**ï¼Œ é€šè¿‡åˆ¤å®šä¸¤ä¸ªç»“æœäº¤å‰çš„å€¼æ¥è·å–æŒ‰é”®æ‰€åœ¨çš„è¡Œåˆ—ã€‚

ä¾‹å¦‚: S1æŒ‰ä¸‹æ—¶, è¡Œæ‰«æç»“æœä¸º 0000 0111 è€Œåˆ—æ‰«æç»“æœä¸º: 0111 0000
æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡æˆ–è¿ç®—å¾—åˆ°: 0111 0111 å³0x77ä¸º1è¡Œ1åˆ—çš„ç»“æœã€‚

æ–¹æ³•ä¸€æ˜¯<mark style="background: transparent; color: red">å‚è€ƒä¸‹å›¾</mark>çš„è®¡ç®—æ–¹æ³•, åˆ©ç”¨è¡Œè®¡ç®—å‡ºåˆ—, æ˜¯æœ€çœæœºæ—¶çš„æ–¹æ³•ã€‚
![[attachments/Pasted image 20231208213436.png]]
æ–¹æ³•äºŒæ˜¯ç›´æ¥åˆ†åˆ«æˆ–åˆ¤æ–­

`````ad-note
title: çº¿ç¿»è½¬æ³•å…³é”®ä»£ç 
collapse: close

```c
u8 button_test(u8 key){
    u8 key_pressed = 0;
    switch(key){ // only return the key it pressed
        case 0x77: key_pressed = 1; break; // P1_7, P1_3, which is 0111, 0111
        case 0x7b: key_pressed = 2; break; // 0111 1011
        case 0x7d: key_pressed = 3; break; // 0111 1101
        case 0x7e: key_pressed = 4; break; // 
        case 0xb7: key_pressed = 5; break; 
        case 0xbb: key_pressed = 6; break;
        case 0xbd: key_pressed = 7; break; 
        case 0xbe: key_pressed = 8; break;
        case 0xd7: key_pressed = 9; break;
        case 0xdb: key_pressed = 10; break;
        case 0xdd: key_pressed = 11; break;
        case 0xde: key_pressed = 12; break;
        case 0xe7: key_pressed = 13; break;
        case 0xeb: key_pressed = 14; break;
        case 0xed: key_pressed = 15; break; // only can goto F
        default: key_pressed = 0; break; // key_pressed = 0
    }
    return key_pressed;
}


// line_col_button_scan 
void line_col_scan(){
    u8 res1, res2, res;
    P1 = 0x0f; // 0000 1111, rows are all low voltage level;
    // when there is button pressed 
    if (KEY_MATRIX_PORT!=0x0f){
        Delay(10);  // we only need to eliminate shaking once.
        while (KEY_MATRIX_PORT!=0x0f){
            res1 = KEY_MATRIX_PORT; 
            // test result2
            P1 = 0xf0;
            res2 = KEY_MATRIX_PORT;
            // set to 0xf0,  jump out when unpress the button
            res = res1 | res2; 
            ShowNum(button_test(res)); 
            P1 = 0x0f;  // reset the testing process
        }
    }
    P1 = 0xff;
    ShowNum(0); // show 0
}
```

`````

# ä¸€èˆ¬çš„é”®ç›˜æŒ‰é”®æ£€æµ‹åŸç†
å¼€æºèµ„æ–™æ¥è‡ª[ç€šæ–‡æ™ºèƒ½é”®ç›˜](https://oshwhub.com/pengzhihui/b11afae464c54a3e8d0f77e1f92dc7b7)

![[attachments/Pasted image 20231208103118.png]]

ä¸€èˆ¬é”®ç›˜çš„é˜²è¯¯è§¦æ–¹æ³•å‚è€ƒ[äºŒæç®¡åŠæ³•è§£å†³é¬¼é”®é—®é¢˜](https://zhuanlan.zhihu.com/p/587061637)



ç¼“å˜è¡Œåˆ—å¼æ‰«ææŒ‰é”®ä»£ç 
```c
0x0E // 0000 1110
0x0D // 0000 1101
0x0B // 0000 1011
0x07 // 0000 0111
```



é¦–å…ˆ, å¯¹äº**è¡Œåˆ—å¼çš„æ‰«æ, éœ€è¦è€ƒè™‘æŒ‰é”®çš„æ¶ˆæŠ–é—®é¢˜**, å‡å¦‚æ¶ˆæŠ–æœ‰5msçš„å»¶è¿Ÿ, åˆ†åˆ«åˆ¤æ–­æ¯ä¸€ä¸ªé”®, åˆ™ä¼šå¯¼è‡´åˆ¤æ–­æ—¶é—´åŠ èµ·æ¥è¿‡é•¿ã€‚

å‚è€ƒ[[ğŸ’»softwares/âš¡Circuit/51å•ç‰‡æœºæ•™ç¨‹/æŒ‰é”®, LEDç¯,èœ‚é¸£å™¨, æ•°ç ç®¡/æŒ‰é”®çš„åŸºæœ¬åŸç†#æŒ‰é”®æ£€æµ‹å°è£…å‡½æ•°åŠå…¶ä¼˜åŒ–|æŒ‰é”®çš„åŸºæœ¬åŸç†]], åªéœ€ä½¿ç”¨

```c
// æ³¨æ„: ç»å¯¹ä¸èƒ½åœ¨define åé¢åŠ åˆ†å·
#define KEY_MATRIX_PORT P1
#define SMG_A_DP_PORT P0
```
