SG90舵机是通过PWM 信号来控制舵机移动的部分, 

其中深红色信号线GND, 橙红色VCC, 黄色为PWM信号线。


通过调节PWM信号的占空比来实现舵机的旋转不同角度的控制。 

我们假设整个信号的频率为2s, 则对应的旋转角度为以下的占空比: 
就是指在一个周期内，信号处于高电平的时间占据整个信号周期的百分比
 0.5ms-------------0度； 2.5% 对应函数中占空比为250

1.0ms------------45度； 5.0% 对应函数中占空比为500

1.5ms------------90 度； 7.5% 对应函数中占空比为 750
2.0ms-----------135 度； 10.0% 对应函数中占空比为 1000
2.5ms-----------180 度； 12.5% 对应函数中占空比为 1250
中断处理函数

![[attachments/Pasted image 20240122203432.png]]

示例代码如下: 
```c
#include <REGX52.H>
#include "public.h"
#include "timer_controller.h"
sbit PWM = P2^0;
sbit K1  = P3^1;
sbit K2  = P3^0;
sbit K3  = P3^2;
sbit K4  = P3^3;
u8 en = 0, t1 = 0;
// 0.1ms timer
void Timer1_FUNC() interrupt 3{

    TH1 = 0xff; TL1 = 0xa4;

    if (en) t1++;

}

  

// result  is degree x 9 -> input 0 is 0 degree

void SG90_Rotate(u8 degree){

    TH1 = 0xff; TL1 = 0xa4; en = 1;

    PWM = 1;

    while (t1 < 5 + degree);

    PWM = 0;

    while (t1 < 200);

    t1 = 0; en = 0; // reset;

}

  

void main(){

    PWM = 0;

    P2_7 = 0;

    TIMER1_START();

    while (1){

        if (!K1){

                Delay(10);

                P2_1 = 0;

                while (!K1)

                {

                    SG90_Rotate(0); // * 9 = 45 degree

                }

                P2_1 = 1;

        }

        if (!K2){

            Delay(10);

            P2_2 = 0;

            while (!K2){

                     SG90_Rotate(5);

            }

    }

        if (!K3){

                Delay(10);

                while (!K3)

                {

                        SG90_Rotate(10);

                }

        }

        if (!K4){

                Delay(10);

                while (!K4)

                {

                        SG90_Rotate(17);

                }

        }

    }

}
```